<!DOCTYPE HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">
<HTML>
	<HEAD>
		<TITLE>Compiling an Eiffel system for CECIL</TITLE>
		<META NAME="MS-HKWD" CONTENT="CECIL from Eiffel">
		<LINK REL=Stylesheet HREF="../../default.css" TYPE="text/css">
	</HEAD>

	<BODY>
		<H1>Compiling an Eiffel system for CECIL</H1>
        <h2>Compiling your Eiffel system for CECIL</h2>
          It is very simple to &quot;Cecilize&quot; your Eiffel system, that is
          to say make its features available from the outside through CECIL. You
          will compile it as you normally would - either freeze it or finalize
          it. The only supplementary precaution is to protect from the dead-code
          remover any Eiffel features that are not called from the Eiffel
          system's root, and might thus be dead-code-removed by the optimization
          mechanism.
          <p>To do this, include the appropriate features and classes in the <i>visible</i>
          clause of the Ace file, as in
            <pre>&nbsp;&nbsp;&nbsp; <b><font color="#000080">system
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; system_name
&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">root
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">default
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">cluster
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; your_cluster: &quot;...&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">adapt
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">visible
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLASS1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLASS2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">creation
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;other_make&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">export
</font></b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;other_make&quot;, &quot;feat1&quot;, &quot;feat2&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">end</font></b><i>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </i><b><font color="#000080">end

</font></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... Other clusters ...
&nbsp;
&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp; <b><font color="#000080">end</font></b></pre>
          Here all features of <i>CLASS1</i> are available to the external
          software; for <i>CLASS2</i>, only <i>other_make</i> (for creation) and
          <i>feat1</i> and <i>feat2</i> (for normal call) are available. For the
          full set of <span class="ekeyword">visible</span> options, see
          appendix D of <i>Eiffel: The Language</i>. If you omit the
          clause <span class="ekeyword">export</span>, only the features
          with no export clause in the Eiffel code, will be available.
          The creation procedure of a visible class is always
          available.
        <h2>Building a CECIL archive</h2>
          The ISE-EiffelBench 5.0 compiler produces both C code and a
          &quot;Makefile&quot;. The Makefile compiles and links that C code in a
          subdirectory one level below the EIFGEN directory of a project. For
          frozen/melted code, the Makefile is located in the W_code
          subdirectory. For finalized code, it is in the F_code subdirectory.
          <p>To produce a CECIL library, you must: open a shell (unix) or the
          MS-DOS prompt (Windows), go to the subdirectory that contains the
          Makefile, and then type:
          <ul>
            <b>make cecil </b>(on unix and on windows with Borland)<br>
            <b>nmake cecil </b>(on windows with VC++)
          </ul>
          <p>This generates a CECIL archive whose name derived from the name
          &lt;system name&gt; of the Eiffel system, as follows:
          <ul>
            lib&lt;system name&gt;.a&nbsp; (on unix)<br>
            lib&lt;system name&gt;.lib (on Windows)
          </ul>
          For example, the corresponding archive for an Eiffel system
          called &quot;test&quot;, would be called either &quot;libtest.a&quot;
          (Unix) or libtest.lib (Windows).
        <p>Note that through CECIL you can use an Eiffel system
        compiled in any of the Eiffel compilation modes:
        <ul>
          <li>Finalized C code.
          <li>Workbench (melted/frozen) code, usually for development
            purposes. In this case you must copy the <i>&lt;system
            name&gt;.melted</i> file ( where <i>&lt;system name&gt;</i> is the
            name of your system) located in EIFGEN\W_code to the directory where
            you intend to execute your C application from.</li>
        </ul>
        <p class="note"><b>Note</b>: each time you melt the Eiffel system, the <i>&lt;system name&gt;.melted</i>
            file is updated.</p>
        <p class="warning"><b>Caution</b>: in the second case (workbench mode), it is not possible to call
        through the CECIL interface any routine that has been melted in the last
        compilation; this would raise the run-time exception:
        <br>
        <b>
          &nbsp;&nbsp;&nbsp;
          $ applied to melted routine</b><br>
        The solution is simply to refreeze the system.</P>
	</BODY>
</HTML>