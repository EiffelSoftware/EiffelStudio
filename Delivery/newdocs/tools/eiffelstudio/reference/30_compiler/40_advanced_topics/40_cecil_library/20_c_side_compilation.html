<!DOCTYPE HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">
<HTML>
	<HEAD>
		<TITLE>Using a CECIL archive</TITLE>
		<META NAME="MS-HKWD" CONTENT="Compiler">
		<LINK REL=Stylesheet HREF="/default.css" TYPE="text/css">
	</HEAD>

	<BODY>
<h1>Using a CECIL archive</h1>
<h2>Linking the CECIL archive into a program</h2>
  The CECIL archive already incorporates the Eiffel run-time. To use the
  functions provided in the CECIL archive, simply write the C programs according
  to the CECIL specifications of ETL, and then include the CECIL archive in the
link line of your C application. This line looks like:
  <p>on Unix/linux:
  <p><b>ld -o [name of your CECIL executable] [your C object files and archives]
  lib&lt;system name&gt;.a -lm</b>
  <p>on Windows, with MS VC++:
  <p><b>link [your link flags] -OUT:[name of your cecil executable] [your C
  object files and archives] lib&lt;system name&gt;.lib [other Windows
  libraries]</b>
  <p class="note"><b>Note</b>: linking with &quot;-lm&quot; is required since the Eiffel run-time
  uses the standard math libraries. You may need to link with other libraries
  (for example, on linux: with &quot;-lbsd&quot;, in MT mode with &quot;-lpthread&quot;
  (posix threads) or &quot;-lthread&quot; (solaris)).</p>
  <p class="tip"><b>Tip</b>: On Windows, you can reuse the .lnk file, which is
  automatically generated when you freeze or finalize your system: go to the
  appropriate directory (W_code or F_code) and locate the file:<br>
  &lt;system_name&gt;.lnk</P>
<p>
  <br>
  To have a Cecilized version (that is to say, a version
  usable from external software) you should:
<ul>
  <li>Copy &lt;system_name&gt;.lnk into a new file cecil.lnk in the same directory.</li>
  <li>Add the directive
  &quot;console_application (yes)&quot; in your Ace file to use the current MS-DOS shell as the default console.</li>
  <li>Replace the line:</li>
  <br>&nbsp;&nbsp;&nbsp; e1\emain.obj
  <br>by:
  <br>&nbsp;&nbsp;&nbsp; ..\..\main.obj
  <br>(assuming that the main.obj object file is in the project
  directory; update the above path if it is in another directory).
  <li>Link with:<br>
  link @cecil.lnk<br>
  (in the appropriate directory W_code or F_code)</li>
</ul>
<p><b><u>Notes for compiling
  CECIL C files:</u></b><br>
  The CECIL library is built automatically, which is unfortunately not
  the case of the corresponding object files of the cecil program you
  wrote.<br>
  The C flags to use are usually the same as the ones needed during the
  compilation of the generated C-code plus those which are relevant to your own
  C-code.
  <p>Typically, you will compile with your flags as below:
  <p><b>gcc -c -O -I$ISE_EIFFEL/bench/spec/$PLATFORM/include -I&lt;SOME_INCLUDE_PATH&gt;
  -D&lt;SOME_FLAGS&gt; your_file.c</b><br>
  (if your are compiling with gcc on a Solaris).
  <p>or
<p><b>cl -c -nologo -Ox -I&lt;INSTALLATION_DIR&gt;\bench\spec\windows\include
  -I&lt;SOME_INCLUDE_PATH&gt; -D&lt;SOME_FLAGS&gt; your_file.c</b><br>
  (if you are using VC on Windows. <b>&lt;INSTALLATION_DIR&gt;</b> is the
  installation directory of your Eiffel delivery: <b>C:\Eiffel50</b>, for
  example).
<p class="sample"><b>Sample</b>: if you want to use the multithreaded facilities of Eiffel,
  you should define the EIFFEL MT flags like this:<b><br>
gcc -c -O -I$EIFFEL4/bench/spec/$PLATFORM/include -DEIF_THREADS -DSOLARIS_THREADS
  -D_REENTRANT your_file.c<br>
</b>or<b><br>
cl -c -nologo -DEIF_THREADS -MT -Ox -I&lt;INSTALLATION_DIR&gt;\bench\spec\windows\include
  your_file.c</b>
  <p>You can specify a Makefile in your Ace file, so that your C files will be
  compiled automatically after the Eiffel compilation and before the final
  linking. Just add at the end of your Ace file in the external clause:
  <CODE><p><i>external:</i><br>
  <i>&nbsp;&nbsp;&nbsp; make:&nbsp;&nbsp;&nbsp; &quot;$PATH_TO_MAKEFILE/your_makefile&quot;;</i></CODE>
  <p>This makefile will be run from the $/EIFGEN/W_code or $/EIFGEN/F_code
  directory. You should not give the CECIL executable the same name as your
  system, because it will be replaced by the Eiffel executable when you run
  another compilation.</p>
<h2>Initializing the Eiffel run-time</h2>
  Even though the main thread of control resides in the &quot;C side&quot; of
  the program, the Eiffel run-time must be initialized correctly before it can use CECIL facilities to communicate with the Eiffel world.
  <p>In the C file containing the &quot;main&quot; C function, you must add the
  following line to include the header file &quot;eif_setup.h&quot; provided
  with this example:<CODE>
  <p><i>#include &quot;eif_setup.h&quot;&nbsp; /* Macros EIF_INITIALIZE and
  EIF_DISPOSE_ALL */</i><br>
  <i>#include &quot;eif_eiffel.h&quot; /* Exported functions of the Eiffel
  run-time */</i></code>
  <p>Your &quot;main&quot; function must have the three standard arguments of
  the C &quot;main&quot; function: &quot;argc&quot;, &quot;argv&quot; and
  &quot;envp&quot; and include the following macros that are defined in &quot;eif_setup.h&quot;:<CODE>
  <p><i>main(int argc, char **argv, char **envp)</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Please respect this
  signature: `argc', `argv' and `envp' are used</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * in EIF_INITIALIZE.</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</i><br>
  <i>{</i><br>
  <i>&nbsp;&nbsp;&nbsp; /* declarations of variables */</i>
  <br><i>&nbsp;&nbsp;&nbsp; EIF_INITIALIZE(failure)</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Initialize the Eiffel run-time. */</i>
  <br><i>&nbsp;&nbsp;&nbsp; /* ...</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp; body of your &quot;main&quot; function</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ... */</i>
  <br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EIF_DISPOSE_ALL</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Reclaim the memory allocated by the Eiffel</i><br>
  <i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  * run-time. */</i><br>
  <i>}</i></CODE>
  <p class="sample"><b>Samples</b>: See the cecil examples on <a href="ftp://ftp.eiffel.com/examples/cecil">ftp://ftp.eiffel.com/examples/cecil</a>.</P>
  <p class="note"><b>Notes</b>:<br>
  The above mentioned macros must imperatively be in the body of
  the &quot;main&quot; function for the Eiffel exception handling mechanism to
  work correctly.<b><br>
  <br>
  </b>You also need to add the Eiffel run time directory to the list of
  directories in which the C compiler searches for include files. You can do so
  by using the &quot;-I&quot; option of your C compiler.<b><br>
  <br>
  </b> You can only link one CECIL library into your C applications at
  a time.</P>
  <p class="warning"><b>Caution</b>: Even though external object files and archives are correctly specified in the
  &quot;object&quot; clause of the Ace file, you will need to explicitely link
  them to your C application.</p>

</BODY>
</HTML>