#!/bin/tcsh

# Remove former test directory
cd $EWEASEL/..
\rm -rf test_dir/*

# Build precompiled library
cd $ISE_EIFFEL/library
svn up base time thread store 

#Performing single threaded precompilation
cd $ISE_EIFFEL/precomp/spec/$ISE_PLATFORM
$ISE_EIFFEL/studio/spec/$ISE_PLATFORM/bin/ec -config base.ecf -precompile -c_compile -clean

#Performing multithreaded precompilation
cd $ISE_EIFFEL/precomp/spec/$ISE_PLATFORM
$ISE_EIFFEL/studio/spec/$ISE_PLATFORM/bin/ec -config base-mt.ecf -precompile -c_compile -clean

# Launch EiffelWeasel tests
cd $EWEASEL/..

eweasel -clean -define HOME $EWEASEL -define INCLUDE $EWEASEL/control -define EWEASEL $EWEASEL -define ISE_EIFFEL $ISE_EIFFEL -define ISE_PLATFORM $ISE_PLATFORM -define UNIX 1 -define PLATFORM_TYPE unix -init $EWEASEL/control/init -catalog $EWEASEL/control/catalog -output $EWEASEL/../test_dir > $1

