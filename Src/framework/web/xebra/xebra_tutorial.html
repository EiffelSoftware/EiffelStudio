<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Xebra Tutorial </title>
<style type="text/css">
<!--
body,td,th {
	font-family: Geneva, Arial, Helvetica, sans-serif;
	font-size: 16px;
	color: #333333;
}
h1 {
	color: #000099;
}
h2 {
	color: #003399;
}
h3 {
	color: #0033FF;
}
.code {
	font-family: "Courier New", Courier, monospace;
	font-size: 17px;
	font-style: normal;
	font-weight: bold;
	color: #11AADD;
}
.path {
	font-family: "Courier New", Courier, monospace;
	font-size: 16px;
	font-style: normal;
	font-weight: italique;
	color: #3333FF;
}
-->
</style>
</head>

<body>
<h1>Xebra Tutorial </h1>
<h2>Notes</h2>
<p><strong>Use Xebra revision 78423 for this tutorial</strong>.</p>
<p>This tutorial was tested on Ubuntu 8.10 with EiffelStudio 6.4.7.8212</p>
<h2>Checkout</h2>
<ul>
  <li>Checkout xebra from <a href="https://svn.origo.ethz.ch/eiffelstudio/trunk/Src/framework/web/xebra/" class="path">https://svn.origo.ethz.ch/eiffelstudio/trunk/Src/framework/web/xebra/</a> to <span class="path">$XEBRA_DEV</span></li>
  
</ul>

<h2>Setup mod_xebra </h2>
<p><strong>Note</strong>: Mod_xebra does currently not run with the apache distribution that comes with ubuntu. </p>

<ul>
  <li>  Download apache unix source httpd-2.2.11 from <span class="path"><a href="http://httpd.apache.org/download.cgi">http://httpd.apache.org/download.cgi</a></span><a href="http://httpd.apache.org/download.cgi"><br />
    <br />
  </a>
  <li> Extract <br />
    <br />
  </li>
  <li> Compile and install apache:<br />
    Define <span class="path">$APACHE2 </span>where you want to install apache to, e.g. to <span class="path">/home/apache2</span><br />
    Run the following command:<br />
    <span class="code">CFLAGS=&quot;-ggdb&quot; ./configure --prefix=/home/apache2</span><br />
    (with CFLAGs you can add compiler flags like -ggdb, which generates debug information for gdb)<br />
    then run<br />
    <span class="code"><strong>make</strong><br />
  <strong>make install</strong></span><br />
  (see here for more info about installation: <a href="http://httpd.apache.org/docs/2.2/install.html">Install</a> ).
  <br />
  </li>
  <li> Compile the module by running<br />
    <span class="code"><strong>cd $XEBRA_DEV/c_projects/mod_xebra</strong><br />
    <strong>$APACHE2/bin/apxs -c -Wc,-ggdb -I$ISE_EIFFEL/studio/spec/$ISE_PLATFORM/include mod_xebra.c mod_xebra.h</strong></span><br />
    <br />
  </li>
  <li> Install the module to apache by running<br />
    <span class="code">sudo <strong>$APACHE2/bin/</strong>apxs -i mod_xebra.la</span><br />
    <br />
  </li>
  <li> Add the following lines to <span class="path">$APACHE2/conf/httpd.conf</span>:<br />
    <span class="code">LoadModule xebra_module modules/mod_xebra.so</span><br />
    <span class="code">AddHandler mod_xebra .xeb<br />
    XebraServer_port &quot;55000&quot;<br />
  XebraServer_host &quot;localhost&quot;</span><br />
  <span class="code">LogLevel debug</span><br />
  <br />
  </li>
  <li> Restart apache (if necessary, you need to stop and start instead of restart)<br />
  <span class="code">sudo <strong>$APACHE2/bin/</strong>apachectl restart</span><br />
  <br />
  </li>
  <li>Browse to <a href="http://localhost/test.xeb">http://localhost/test.xeb</a>.You should see the Fail Whale and a message saying &quot;Cannot connect to XebraServer. See apache error log.&quot;<br />
    <br />
  </li>
  <li> Hint: keep an eye on the apache error log<br />
    <span class="code">tail -f <strong>$APACHE2</strong>/logs/error_log</span></li>
</ul>
<p>&nbsp;</p>
<h2>Run the Xebra Server</h2>
<ul>
  <li>Open estudio in a terminal and open the project <span class="path">$XEBRA_DEV/eiffel_projects/xebra_server/xebra_server-voidunsafe.ecf</span><br />
    <br />
  </li>
  <li>Compile and Run<br />
    <br />
  </li>
  <li>Browse again to <a href="http://localhost/test.xeb">http://localhost/test.xeb</a>.You should see a Xebra Server Error Report (also with the Fail Whale) with a message saying &quot;Cannot find web application ' ' &quot;<br />
</li>
</ul>
<p>&nbsp;</p>
<h2>Run the Xebrawebapp (simple web application)</h2>
<p>You can use the tutorial web application <span class="path">xebrawebapp</span> at <span class="path">$XEBRA_DEV/websites/xebrawebapp</span> to start. To use it do the following:</p>
<ul>
  <li>Create the Folder <span class="path">$APACHE2/htdocs/xebrawebapp<br />
  </span></li>
</ul>
<ul><li>Run<br />
    <span class="code">cd $XEBRA_DEV/websites/xebrawebapp/<br />
    ./generate-webapp.sh</span><br />
    (due to a current bug, you have to run the script twice)<br />
    <br />
    </li>
  <li>Open estudio in a terminal and open the project at <span class="path">$XEBRA_DEV/websites/xebrawebapp/xebrawebapp-voidunsafe.ecf</span>  and compile<br />
      <br />
  </li>
  <li>Add Execution Parameter "55006"<br />
      <br />
  </li>
  <li>Make sure the xebra server and the correct apache (with xebra_mod) is running, then run the web application<br />
      <br />
  </li>
  <li>Browse to <a href="http://localhost/xebrawebapp/hello.xeb">http://localhost/xebrawebapp/hello.xeb</a>, you should see &quot;Hello World!&quot;</li>
</ul>
<p>&nbsp;</p>
<h2>Run the Demoapplication (advanced web application)</h2>
<ul><li>
  <p>You can use the tutorial web application <span class="path">demoapplication</span> at <span class="path">$XEBRA_DEV/websites/demoapplication</span> to start. To use it do the following:  
      <br />
    </p>
    <ul><li>Create the Folder <span class="path">$APACHE2/htdocs/demoapplication<br />
        <br />
      </span></li>
      <li>Copy the folder <span class="path">$XEBRA_DEV/websites/demoapplication/html/images</span> to <span class="path"> $APACHE2/htdocs/demoapplication</span><br />
        <br />
      </li>
      <li>Copy <span class="path">$XEBRA_DEV/websites/demoapplication/html/style.css</span> to <span class="path">$APACHE2/htdocs/demoapplication</span><span class="code">/<br />
        <br />
      </span></li>
    </ul>
    <ul>
      <li>Run<br />
        <span class="code">cd $XEBRA_DEV/websites/demoapplication/<br />
          ./generate-webapp.sh</span><br />
          (due to a current bug, you have to run the script twice)<br />
        <br />
      </li>
      <li>Open estudio in a terminal and open the project at <span class="path">$XEBRA_DEV/websites/demoapplication/demoapplication-voidunsafe.ecf</span>  and compile<br />
        <br />
      </li>
      <li>Add Execution Parameter "55005"<br />
      <br />
  	</li>
      <li>Make sure the xebra server and the correct apache (with xebra_mod) is running, then run the web application<br />
        <br />
      </li>
      <li>Browse to <a href="http://localhost/demoapplication/home.xeb">http://localhost/demoapplication/home.xeb</a>, you should see the site</li>
    </ul>
    <br />
  </li>
</ul>
<h2>Create a new Web Application (Under construction)</h2>
<p>If you want to create your own application remember the following important steps:
  <span class="code"><br />
</span></p>
<ul>
  <li>Add the libraries
    <ul>
      <li><span class="path">base-safe.ecf</span><span class="code"></span></li>
      <li><span class="path">$XEBRA_DEV/eiffel_projects/library/xebra_http/xebra_http.ecf</span></li>
      <li><span class="path">$XEBRA_DEV/eiffel_projects/library/xebra_web_application/xebra_web_application.ecf</span></li>
      <li>don't use precompile<br />
        <br />
        </li>
    </ul>
  </li>
  <li>Create the folder: <span class="path">$WEBAPP/servlet_gen</span><br />
    <br />
  </li>
  <li>Create the xeb files in  <span class="path">$WEBAPP</span><br />
    <br />
  </li>
  <li>Create a new class <span class="path">(YOURNAME)_CONTROLLER</span> that inherits from <span class="path">XWA_CONTROLLER</span><br />
    <br />
    </li>
  <li>Create a new class <span class="path">(YOURNAME)_GLOBAL_STATE</span><br />
    <br />
  </li>
  <li>Change the root class to <span class="path">(YOURNAME)_G_APPLICATION<br />
    </span><br />
  </li>
  <li>Set project settings - target - advanced - multithreaded to true<span class="code"><br />
    <br />
  </span></li>
  <li>Adapt the three files <span class="path">generate-webapp.sh</span>, <span class="path">input_servlet_gen.txt</span> and <span class="path">input_translator.txt</span> to match the new paths<br />  
    <br />
  </li>
  <li>Create the folder <span class="path">$APACHE2/htdocs/(YOURNAME)</span></li>
</ul>
</body>
</html>
