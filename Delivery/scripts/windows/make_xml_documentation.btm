remtrace Check the status
iff not defined DOCUMENT_DIR then
	echo DOCUMENT_DIR is not defined. Cannot continue
	CANCEL
endiff
iff not isdir %DOCUMENT_DIR then
	echo %DOCUMENT_DIR is not a directory
	CANCEL
endiff
iff not isdir %STUDIO_DIR\docs then
	echo No destination directory for the documentation
	CANCEL
endiff
iff "%@SEARCH[hhc.exe]" == "" then
	echo Cannot find a version of HTML Help. Cannot continue
	CANCEL
endiff

remtrace --------------------------------------------------------
remtrace Checkout up to date version of XML documentation files |
remtrace --------------------------------------------------------

cdd %DOCUMENT_DIR
if isdir xmldoc fullrd xmldoc
if exist xmldoc fullrd xmldoc
co -r %ORIGO_SVN_REVISION %DEFAULT_ORIGO_SVN/Documentation/xmldoc xmldoc


remtrace ---------------------------------------------
remtrace Checkout and compile the Documentation tool |
remtrace ---------------------------------------------

cdd %EIFFEL_SRC\tools
co -r %ORIGO_SVN_REVISION %DEFAULT_ORIGO_SVN/Src/tools/doc_builder doc_builder
cd %EIFFEL_SRC\tools\doc_builder
clean_project
finalize doc_builder.ecf
cleanup_eiffel doc_builder doc_builder.exe
iff not exist doc_builder.exe then
	remtrace Couldnt generate doc_builder.exe
	CANCEL
else
	move doc_builder.exe %DOCUMENT_DIR
endiff


remtrace ---------------------------------------------------------------
remtrace Compile all required libraries and generate XML documentation |
remtrace ---------------------------------------------------------------

cdd %EIFFEL_SRC\tools\doc_builder\resources\xml
melt all_libs.ecf
ecb -local -flatshort -filter xml -all -config all_libs.ecf >>& %INSTALL_LOG

remtrace ------------------------------------------------------
remtrace Copy XML docs into appropriate written docs location |
remtrace ------------------------------------------------------

cdd %EIFFEL_SRC\tools\doc_builder\resources\xml\Documentation
fullrd *.html
fullrd *_links.xml
fullrd *_short.xml

remtrace Removing implementation classes
cd vision2
fullrd *_imp_*.xml
sed -e "s/^.*_imp_.*$//g" index.xml >> new_index.xml
move new_index.xml index.xml
gvim.exe -c "set ff=dos" -c "wq" index.xml

cdd %EIFFEL_SRC\tools\doc_builder\resources\xml\Documentation

move /s base %DOCUMENT_DIR\xmldoc\libraries\base\reference >>& %INSTALL_LOG
move /s wel %DOCUMENT_DIR\xmldoc\libraries\wel\reference >>& %INSTALL_LOG
move /s vision2 %DOCUMENT_DIR\xmldoc\libraries\vision2\reference >>& %INSTALL_LOG
move /s com %DOCUMENT_DIR\xmldoc\libraries\com\reference >>& %INSTALL_LOG
move /s eiffel2java %DOCUMENT_DIR\xmldoc\libraries\eiffel2java\reference >>& %INSTALL_LOG
move /s lex %DOCUMENT_DIR\xmldoc\libraries\lex\reference >>& %INSTALL_LOG
move /s parse %DOCUMENT_DIR\xmldoc\libraries\parse\reference >>& %INSTALL_LOG
move /s net %DOCUMENT_DIR\xmldoc\libraries\net\reference >>& %INSTALL_LOG
move /s thread %DOCUMENT_DIR\xmldoc\libraries\thread\reference >>& %INSTALL_LOG
move /s time %DOCUMENT_DIR\xmldoc\libraries\time\reference >>& %INSTALL_LOG
move /s web %DOCUMENT_DIR\xmldoc\libraries\web\reference >>& %INSTALL_LOG
move /s store %DOCUMENT_DIR\xmldoc\libraries\store\reference >>& %INSTALL_LOG
move /s preferences_reg %DOCUMENT_DIR\xmldoc\libraries\preferences\reference >>& %INSTALL_LOG

	
remtrace ----------------------------------------------------------------------------------------
remtrace Run the documentation tool to generate the documentation for EiffelStudio as .chm file |
remtrace ----------------------------------------------------------------------------------------

cdd %DOCUMENT_DIR
doc_builder.exe -gen /xml2help -o /studio -t /mshtml -nohtml %DOCUMENT_DIR\xmldoc\projects\documentation.dpr
cdd C:\doc\Html
fullrd docs.chm
hhc docs.hhp
copy C:\doc\Html\docs.chm %STUDIO_DIR\docs\eiffel.chm

rem cdd %DOCUMENT_DIR
rem doc_builder.exe -gen /xml2help -o /studio -t /mshtml %DOCUMENT_DIR\xmldoc\documentation.dpr
rem copy C:\doc\Html\docs.chm %STUDIO_DIR\docs\eiffel.chm


