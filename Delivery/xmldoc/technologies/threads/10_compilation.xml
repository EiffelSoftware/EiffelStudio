<document title="Compilation of multithreaded systems" output="studio">
	<meta_data>
		<help>
			<meta>
				<meta_content>multi-threaded systems, compile</meta_content>
				<name>MS-HKWD</name>
			</meta>
		</help>
	</meta_data>
	<paragraph>
		<heading>
			<size>2</size>Settings
		</heading>
		<list ordered="false">
			<item>Add the option multi-threaded by setting the value in  
				<link>
					<url>../../tools/eiffelstudio/reference/25_project_settings/050_advanced_general.xml</url>
					<label>the advanced section of the project setting window </label>
				</link>to true.
			</item>
			<item>Do not use a non-multi-threaded precompiled library. The corresponding multi-threaded libraries of base and WEL should be located in $ISE_EIFFEL/precomp/spec/$PLATFORM/ with the mt prefix. </item>
			<item>You may want to include the thread library (located at "$ISE_EIFFEL/library/thread") to your project. This setting can be done in 
				<link>
					<url>../../tools/eiffelstudio/reference/25_project_settings/040_target_groups.xml</url>
					<label> the groups section of the project settings window</label>
				</link>.
			</item>
			<item>When using external C libraries, be sure that they are MT-safe: on the platforms where the Eiffel Threads are available. For example 
				<link>
					<url>/libraries/wel/index.xml</url>
					<label>Wel</label>
				</link> and 
				<link>
					<url>/libraries/net/index.xml</url>
					<label>Net</label>
				</link> multi-threaded libraries can be recognized by the `mt' prefix.
			</item>
		</list>
		<heading>
			<size>2</size>Compilation
		</heading>
		<paragraph>Just launch the compilation: the Eiffel compiler will generate and link the multi-threaded executable. If the project was already compiled, clean the project and recompile it from scratch.</paragraph>
		<heading>
			<size>2</size>External C files
		</heading>
		<paragraph>The C files that you link with a multi-threaded Eiffel application must be compiled in multi-threaded mode. In addition, you should follow some basic guidelines, which you can find in any documentation on threads. Here are the main requirements:</paragraph>
		<list ordered="false">
			<item>Check what you are importing is safe: you cannot arbitrarily enter non-threaded code in a multi-threaded program. Check your include files and libraries you use for the linking to decide if they can be used in multi-threaded mode. </item>
			<item>If you are using CECIL in multi-threaded mode, you must compile your C files with the same defined symbols as those used to compile the generated C-code in multi-threaded mode. </item>
			<item>Threaded code can safely refer to unsafe code ONLY from the initial thread. </item>
		</list><note><bold>Note</bold>: if you use the libraries Net and MEL in multi-threaded mode, you should use libmtnet. a and libmtmel. a. When using MEL, you have to be aware that Motif 1. 2 is not threaded-safe (i.e not reentrant). Motif 2. x is threaded-safe.</note>
		<heading>
			<size>2</size>Thread Safe Eiffel libraries
		</heading>
		<paragraph>Most libraries are not thread safe. This means that even though you can use them in a multi-threaded environment, you will need to add the necessary protection to ensure that objects are accessed only by one thread at a time. </paragraph>
		<paragraph>Most of the issues is related to the use of EiffelBase containers which have been designed at a time where threads where not present. In the future we will certainly provide a version of EiffelBase which will be designed to be thread safe, in the meantime, you have to use basic protection mechanism such a mutexes to guarantee a safe execution of your programs. </paragraph>
		<paragraph>Here is a summary of what you need to include in your project settings when using our libraries:</paragraph>
		<paragraph>- EiffelBase: not thread safe, no externals required</paragraph>
		<paragraph>- WEL: partly thread safe regarding creation of graphical objects that belongs to two different threads, but since it relies on EiffelBase, be aware of what has been said. Other libraries have the same dependency on EiffelBase and this warning will not be repeated. Change the library wel. lib by mtwel. lib</paragraph>
		<paragraph>- MEL: you have to be aware that Motif 1. 2 is not thread safe and that Motif 2.x is. Therefore you can use MEL in a multi-threaded program only if you have Motif 2.x. In this case, you need to include libmtmel.a instead of libmel.a</paragraph>
		<paragraph>- EiffelNet: thread safe with above limitation on EiffelBase. Change the library net.lib by mtnet.lib on Windows. For unix based systems, change libnet.a by libmtnet.a</paragraph>
		<paragraph>- COM: not thread safe. Change com. lib and com_runtime.lib into mtcom.lib and mtcom_runtime.lib. </paragraph>
	</paragraph></document>
