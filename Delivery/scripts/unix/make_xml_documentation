#!/bin/sh

remtrace Checkout up to date version of XML documentation files
cd $DOCUMENT_DIR
exprt -r $DEFAULT_CVS_TAG -d xmldoc Delivery/xmldoc 

remtrace Checkout and compile the Documentation tool
cd $EIFFEL_SRC
safe_md tools
cd $EIFFEL_SRC/tools
exprt -r $DEFAULT_CVS_TAG -d doc_builder Src/tools/doc_builder
cd $EIFFEL_SRC/tools/doc_builder
ec -finalize -ace docbuilder.unix.ace -c_compile &> $INSTALL_LOG
if [ ! -e EIFGEN/F_code/doc_builder ]; then
	remtrace Couldnt generate doc_builder
	CANCEL
fi

remtrace Compile all required libraries and generate XML documentation
cd $EIFFEL_SRC/tools/doc_builder/resources/xml
ec -ace all_libs.ace &> $INSTALL_LOG
ec -flatshort -filter xml -all -project all_libs.epr &> $INSTALL_LOG

remtrace Copy XML docs into appropriate written docs location
cd $EIFFEL_SRC/tools/doc_builder/resources/xml/Documentation
rm -rf *.html
rm -rf *_links.xml
rm -rf *_short.xml
cd vision2/implementation
rm -rf mswin
sed -e "s/^.*mswin.*$//g" index.xml >> new_index.xml
cp new_index.xml index.xml
rm -rf new_index.xml
cd ../contrib
rm -rf implementation
sed -e "s/^.*implementation.*$//g" index.xml >> new_index.xml
cp new_index.xml index.xml
rm -rf new_index.xml

cd $EIFFEL_SRC/tools/doc_builder/resources/xml/Documentation

mv base $DOCUMENT_DIR/xmldoc/libraries/base/reference
mv wel $DOCUMENT_DIR/xmldoc/libraries/wel/reference
mv vision2 $DOCUMENT_DIR/xmldoc/libraries/vision2/reference
mv com $DOCUMENT_DIR/xmldoc/libraries/com/reference
mv eiffel2java $DOCUMENT_DIR/xmldoc/libraries/eiffel2java/reference
mv lex $DOCUMENT_DIR/xmldoc/libraries/lex/reference
mv parse $DOCUMENT_DIR/xmldoc/libraries/parse/reference
mv net $DOCUMENT_DIR/xmldoc/libraries/net/reference
mv thread $DOCUMENT_DIR/xmldoc/libraries/thread/reference
mv time $DOCUMENT_DIR/xmldoc/libraries/time/reference
mv web $DOCUMENT_DIR/xmldoc/libraries/web/reference
mv store $DOCUMENT_DIR/xmldoc/libraries/store/reference


remtrace Run the documentation tool to generate the documentation for EiffelStudio as web based help
cd $EIFFEL_SRC/tools/doc_builder/EIFGEN/F_code

export DOCUMENT_DIR
export EIFFEL_SRC

./doc_builder -gen /xml2help -o /studio -t /web_simple -nohtml $DOCUMENT_DIR/xmldoc/documentation.dpr

move $EIFFEL_SRC/tools/doc_builder/temp/Help $INSTALL_DIR/docs

fullrd $EIFFEL_SRC/xmldoc

cd $EIFFEL_SRC
