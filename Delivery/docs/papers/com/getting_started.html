<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" CONTENT="Microsoft FrontPage 4.0">
<LINK REL="STYLESHEET" HREF="../../styles/tech.css">
<TITLE>EiffelCOM</TITLE><meta name="Microsoft Border" content="t, default">
</HEAD>
<BODY BGCOLOR="#ffffff"><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><table border="0" cellspacing="0" cellpadding="0" width="100%">
  <tr>
    <td valign="top" bgcolor="#000063" width="291"><b><font face="Arial" size="4" color="#FFFFFF">Interactive<br>
      Software Engineering</font></b></td>
    <td valign="top" bgcolor="#000063" width="720"><b><font face="Arial" size="6" color="#FFFFCC">EiffelCOM</font></b></td>
  </tr>
  <tr>
    <td colspan="2" valign="top" width="100%">
<p align="center">[<a href="http://eiffel.com">ISE Home</a>] <nobr>[&nbsp;<a href="../../index.html">Home</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../../release_notes.html">Release&nbsp;Notes</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../index.html">Technology&nbsp;Papers</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../../install.html">Installation&nbsp;Notes</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../../Eiffel/index.html">About&nbsp;Eiffel</a>&nbsp;]</nobr>
<hr>

    </td>
  </tr>
</table></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><!--msnavigation--><td valign="top">
<A NAME="pgfId=374738">
</A>
<H1>Getting Started</H1>
<blockquote>
<A NAME="pgfId=375636"></A>This chapter explains how to use the EiffelCOM wizard
  to create COM components and to access existing components.
</blockquote>
<DIV>
<H6 CLASS="dd-sec2">
<A NAME="pgfId=375637">
 </A>
<A NAME="29789">
 </A>
Creating a new COM component</H6>
<blockquote>
<A NAME="pgfId=375659">
</A>The first tutorial describes creating a COM component from a COM definition
file that is either an IDL file or a Type Library. The tutorial focuses on
creating an in-process (DLL) component, called <i>StringManipulator</i>. The
component exposes one interface <i>IString</i> that includes the functions <i>ReplaceSubstring</i>
and <i>PruneAll</i> corresponding respectively to the features <em>replace_substring</em>
and <em>prune_all</em> of the EiffelBase <em>STRING</em> and the property <i>String</i>
that represents the manipulated string. The property can be set or read. Other
languages will be able to access these features.
</blockquote>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375830">
 </A>
Step by step instructions</H6>
<UL>
<LI CLASS="mm.bull">
<A NAME="pgfId=375641">
 </A>
Launch the EiffelCOM Wizard (from the Start menu, open Programs then EiffelXX and click EiffelCOM Wizard)</LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375695">
</A>Choose <i>Create a new project from a COM definition</i>.</LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375699">
</A>Click <i>Next</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375701">
</A>Choose <i>Server code for a new component</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375703">
</A>Click <i>Next</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375704">
</A>Click the top <i>Browse</i> button and open the file <i>$EIFFEL5\examples\com\wizard\string_manipulator\string_manipulator.idl</i>
where <i>$EIFFEL5</i> represents the path to your EIFFEL50 directory.</LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375705">
</A>Click the bottom <i>Browse</i> button and select the directory where you
want to create the project (later referenced as destination folder). Choose <i>$EIFFEL5\examples\com\wizard\string_manipulator\generated</i>
where <i>$EIFFEL5</i> represents the path to your EIFFEL50 directory. If you
work on a Windows9x machine, please choose a directory with a shorter path, for
example c:\string_manipulator because Windows9x are unable to handle long path
names.</LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375706">
</A>Click <i>Next</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375707">
</A>Choose <i>Automation</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375708">
</A>Click <i>Next</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375716">
</A>Click <i>Finish</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375717">
</A>Wait until the wizard is done.</LI>
</UL>
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375741">
 </A>
First look at the generated code</H6>
<blockquote>

<p><a name="pgfId_375748"></a>At the end of the processing the
wizard automatically launches EiffelBench with the generated project to help you
navigate created Eiffel classes. You might want to look at the file <i>generated.txt</i>
in the destination folder, which contains a list of files generated by the
wizard. The file <i>string_manipulator.log</i> holds summary of the processing
and error and warning messages.</p>
<p align="justify">The deferred class <em>STRING_MANIPULATOR_COCLASS represents
component functionality</em>. It inherits from <em>ISTRING_INTERFACE</em> that
corresponds to the <i>IString</i> interface. It has one descendant <em>STRING_MANIPULATOR_COCLASS_IMP</em>
that implements the deferred features. The default implementation is empty.</p>
</blockquote>
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375810">
 </A>
implementing the component</H6>
<blockquote>
<A NAME="pgfId=375894"></A>
 To do something more interesting than merely return an error to a client edit
 the implementation of the <I>STRING_MANIPULATOR_COCLASS_IMP class</I>. The
 wizard would not overwrite this class in future executions. There is an
 implementation of the class in <i>$EIFFEL5\examples\com\wizard\string_manipulator\server</i>\.
 Copy this file over to <i>$EIFFEL5\examples\com\wizard\string_manipulator\generated\server\component</i>
 and freeze the project. Voila!, you have your first EiffelCOM component up and
 running.
</blockquote>
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375924">
 </A>
Tips</H6>
<UL>
<LI CLASS="mm-bull">
<A NAME="pgfId=375928"></A>
To develop an EiffelCOM component you need to set the
 registry entry MELT_PATH because the system is not launched from the directory
 containing the byte code (by default EIFGEN\W_code). The EiffelCOM component
 client launches the server from its current location and causes the server to
 crash if the MELT_PATH key does not setup properly. To put this value in your
 registry, create a key under HKEY_CURRENT_USER\SOFTWARE\ISE\Eiffel45 with the
 same name as the name of your project (e.g. <i>string_manipulator</i>) and add
 the string value named MELT_PATH containing the path to the byte code (.melted
 file). You will find an example of such entry in the file <i>melted_path.reg</i>
 in $EIFFEL5\wizard\config. Edit this file as needed (replace <i>string_manipulator</i>
 with the name of your system and change the path to point on the correct
 location using `\\' as directory separator) and then double click on it to
 enter the information into the registry.</LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375977">
</A>To test the component, you need to register it first. Register an in-process
component via the <i>regsvr32</i> utility using the following syntax: <i>regsvr32
system_name.dll</i> where <i>system_name</i> is the name of the dll (e.g.
string_manipulator). Register an out-of-process component using the following
syntax: <i>system_name.exe -Regserver</i> where <i>system_name</i> is the name
of the component executable file.</LI>
<LI CLASS="nn-normal">
<A NAME="pgfId=375983">
</A>To complete this tutorial you need to register the component with the
following command (run from a dos console): <i>regsvr32 string_manipulator.dll</i>
and to enter the information in <i>$EIFFEL5\wizard\config\melted_path.reg</i>.
You have to change the content of this file if you have not installed Eiffel
under C:\ and/or have used a different destination directory.</LI>
</UL>

<DIV>
<H6 CLASS="dd-sec2">
<A NAME="pgfId=375637">
 </A>
<A NAME="29789">
 </A>
Creating a new component from an Eiffel project</H6>
<blockquote>

<p>The second tutorial describes creating a COM component from
an Eiffel system. The tutorial example <i>String </i>is almost identical to <i>StringManipulator</i>
of the previous tutorial. In the <i>StringManipulator</i> example the wizard
starts from IDL file and builds an Eiffel System; in contrast, the <i>String</i>
example takes an Eiffel system and generates an IDL file and the required
plumbing code to make the Eiffel project accessible to COM runtime. You do not
need to modify any Eiffel or C code.</p>

</blockquote>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375831">
 </A>
 Step by step instructions</H6>

<blockquote>

<DIV>

<ul>
<li>Create a new Eiffel project in the directory <i>$EIFFEL5\examples\com\wizard\e2idl\eproject</i>
  where $EIFFEL5 represents the path to your EIFFEL50 directory.
<li>Select Ace file from the same directory and compile.
<li>Launch the EiffelCOM Wizard (from the Start menu, open Programs then
  EiffelXX and click EiffelCOM Wizard)
<li>Choose <i>Create a new project from an existing Eiffel project</i>.
<li>Click <i>Next</i>
<li>Click <i>Next</i> again
<li>Click the top Browse button and open the file <i>$EIFFEL5\examples\com\wizard\e2idl\eproject\string.epr</i>
  where $EIFFEL5 represents the path to your EIFFEL50 directory.
<li>Click the second Browse button and open the file <i>$EIFFEL5\examples\com\wizard\e2idl\
  eproject\Ace.ace</i> where $EIFFEL5 represents the path to your EIFFEL50
  directory.
<li>In the third entry field enter <i>string_manipulator</i>.
<li>In the forth entry field enter <i>root_cluster</i>.
<li>Click <i>Next</i>.
<li>Click the Browse button and select the directory where you want to create
  the project (the destination folder). Choose <i>$EIFFEL5\examples\com\wizard\e2idl\generated</i>
  where $EIFFEL5 represents the path to your EIFFEL50 directory. If you work on
  a Windows 9x machine, please choose a directory with a shorter path, for
  example c:\e2idl.
<li>Click <i>Next</i>
<li>Choose Automation
<li>Click <i>Next</i>
<li>Click <i>Finish</i>
<li>Wait until the wizard is done.</li>
</ul>

</div>
</blockquote>

<H6 CLASS="dd-sec3">
<A NAME="pgfId=375832">
 </A>
 First look at the generated code</H6>

<blockquote>

<DIV>

The only generated Eiffel class is COM_&lt;Name_of_system&gt;_REGISTRATION.
    You do not need to modify or implement any classes. The wizard produces a
    ready-to-use component.


</div>
</blockquote>

<H6 CLASS="dd-sec3">
<A NAME="pgfId=375832">
 </A>
 Tips</H6>

<ul>
  <li>In most Eiffel systems functionality is spread out throughout the system. No
  single class exposes the full functionality of the system and can serve as a
  Facade to the outside world. Running the wizard on any such class would not be
  practical. Before starting the wizard write an Eiffel class that acts as a
  Facade and forwards client calls to the appropriate sybsystems. Enter the
  Facade class name into &quot;Enter Eiffel class name&quot; field of the third
  dialog (Eiffel Project File Dialog). The wizard generates an IDL file from
  this class.</li>
</ul>
</DIV>
</DIV>
<DIV>
<H6 CLASS="dd-sec2">
<A NAME="pgfId=375751">
 </A>
Accessing a component</H6>
<blockquote>
<A NAME="pgfId=375755">
</A>The third tutorial describes how to access a COM component and build
reusable library.
</blockquote>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375836">
 </A>
Step by step instructions</H6>
<UL>
<LI CLASS="mm-bull">
<A NAME="pgfId=375756">
 </A>
Launch the wizard</LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375760">
 </A>
Choose <i> Create a new project from a COM definition</i> and click <i> Next</i></LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375764">
 </A>
Click <i> Next</i> again</LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375768">
 </A>
Click the top <i> Browse</i> button and open the file <i> $EIFFEL5\examples\com\wizard\string_manipulator\string_manipulator.idl
</i> where <i> $EIFFEL5</i> represents the path to your EIFFEL50 directory. You could also choose to open the type library (.tlb) that was generated by the wizard when
<A HREF="getting_started.html#29789" CLASS="XRef">Creating a new COM component.</A>
 in the destination folder of that first project.</LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375783">
 </A>
Click the bottom <i> Browse</i> button and select the directory where you want to create the project (later referenced as destination folder). Choose
<i> $EIFFEL5\examples\com\wizard\string_manipulator\client\generated</i> where <i> $EIFFEL5</i> represents the path to your EIFFEL50 directory.</LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375791">
 </A>
Click <i> Next</i></LI>
<LI CLASS="mm.bull">
<A NAME="pgfId=375800">
 </A>
Click <i> Finish</i></LI>
<LI CLASS="mm-bull">
<A NAME="pgfId=375795">
 </A>
Wait until the wizard is done.</LI>
</UL>
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375840">
 </A>
First look at the generated code</H6>
<blockquote>
  <a name="pgfId_375844"></a>At the and of the generation the
  wizard precompiles the generated code and open EiffelBench on the
  precompilation project. Note: a precompilation project is read-only, you need
  to start another EiffelBench to reuse the generated classes. The interesting
  classes are all related to the coclass proxy STRING_MANIPULATOR_PROXY. The
  proxy is the Eiffel class that gives access to the component. Each feature on
  the proxy calls the corresponding interface function on the component. You can
  use the EiffelBench opened by the wizard to browse through the generated
  classes and study the class hierarchy.
  </blockquote>
  <p>&nbsp;
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375854">
 </A>
 Implementing a client</H6>
<blockquote>
<A NAME="pgfId=375858"></A>
 To implement a client of the StringManipulator component open a new
 EiffelBench. Create the project in <i>$EIFFEL5\examples\com\wizard\string_manipulator\client</i>
 using the ace file found in that directory. Freeze and run the project. You are
 now accessing the previously built component and calling functions on its
 interfaces!. The class <em>MY_STRING_MANIPULATOR</em> inherits from the
 generated<em> STRING_MANIPULATOR_PROXY</em> and redefines the feature <i>replace_substring_user_precondition</i>.
 The generated interfaces include contracts for each exposed function. You can
 redefine the <i>user_precondition</i> features to implement your own
 preconditions.
</blockquote>
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=375995">
 </A>
Contracts</H6>
<blockquote>
<A NAME="pgfId=375999">
 </A>
Contracts can be broken directly on the proxy in which case you will get a standard contract violation or in the server. If contracts are broken on the server then the exception will be forwarded by the EiffelCOM runtime to the client. The feature replace_substring_user_precondition in <EM CLASS="ee-text">
MY_STRING_MANIPULATOR </EM>
includes the following commented line:
</blockquote>
<OL>
<TABLE>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
<H6 CLASS="aa-indented">
<A NAME="pgfId=376012">
 </A>
<EM CLASS="ee-comment">
-- Result := True</EM>
</H6>
</TD>
</TR>
</TABLE>
</OL>
<blockquote>
<A NAME="pgfId=376009">
 </A>
Un-comment this line by removing the preceding `<EM CLASS="ee.text">
--</EM>
' and comment out the rest of the feature. Now the contract of the <EM CLASS="ee-text">
replace_substring</EM>
 feature is wrong and erroneous calls can be made. Quick melt the changes and run the client. Enter some invalid numbers in the fields used to call this feature. After you click Replace you will see an error message box warning you that a precondition was violated on the server side. This is how you can use contracts `over the wire'. The preconditions was violated in the server, this exception was caught by the EiffelCOM runtime and sent back to the client.
</blockquote>
</DIV>
<DIV>
<H6 CLASS="dd-sec3">
<A NAME="pgfId=376013">
 </A>
Summary</H6>
<blockquote>
<A NAME="pgfId=376017">
 </A>
You now have the basic knowledge needed to run the EiffelCOM wizard and produce or access COM components. The benefits of using the wizard are numerous including a fast and easy generation of &quot;plumbing&quot; code as well as enhanced debugging capabilities through the use of contracts. The wizard is also very generic, it can generate or wrap any kind of components. We hope you enjoy using it as much as we enjoyed developing it,
</blockquote>
<blockquote>
<A NAME="pgfId=376019">
</A>
The EiffelCOM team.
</blockquote>
</DIV>
</DIV>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<!--msnavigation--></td></tr><!--msnavigation--></table></BODY>
</HTML>
