<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML XMLNS:MSHelp="http://msdn.microsoft.com/mshelp">
	<XML>
		<MSHelp:Keyword Index="K" Term="Calculator" />
		<MSHelp:Keyword Index="K" Term="Samples, Calculator" />
		<MSHelp:Attr Name="Product" Value="Eiffel"/>
		<MSHelp:Attr Name="Locale" Value="kbEnglish"/>
	</XML>
	<HEAD>
		<TITLE>Calculator Sample</TITLE>
		<LINK HREF="../../../default.css" TYPE="text/css" REL="STYLESHEET">
	</HEAD>
	<BODY LANGUAGE="vbscript" ONLOAD="onLoadHandler">
		<TABLE CLASS="HEADER">
			<TR>
				<TD CLASS="HEADER">Eiffel ENViSioN!</TD>
				<TD></TD>
			</TR>
			<TR>
				<TD CLASS="SUBHEADER">Calculator Sample</TD>
				<TD ALIGN=RIGHT>
					<A HREF="#NONEXISTANT" OnClick="LoadSample()">Load in Eiffel ENViSioN! </A>
				</TD>
			</TR>
		</TABLE>
		<TABLE CLASS="FRAME">
			<TR>
				<TD>
					<SCRIPT LANGUAGE=VBScript SRC="sample.vbs"></SCRIPT>
					<SCRIPT LANGUAGE=VBScript>
						Sub onLoadHandler()
							'Initialize global variables
							SampleDir = "\calculator"
							SamplePrj = "calculator.eifp"
						End Sub							
					</SCRIPT>

					<H2>Running the sample</H2>

					<P>After you launch the sample, the following text appears
					in a console:</P>
					
					<PRE>
*********************************
Calculator in reverse Polish form
*********************************
Allowable operations are:
		'/': Divide top two numbers on the stack.
		'0': Empty the stack.
		'a': Enter operand onto stack.
		'?': Help.
		'*': Multiply top two numbers on the stack.
		'+': Add top two numbers on the stack
		'q': Quit.
		'-': Subtract top two numbers on the stack.
Enter a number, followed by <return>:
					</PRE>

					<P>Enter the first number to be put onto the stack, for example
					<SPAN CLASS="esymbol">3</SPAN>.</P>
			
					<P CLASS="note"><B>Note:</B> Failing to enter a number will add
					the number 0 onto the stack. </P>
					
					<P>You may then add another number on the stack by entering the
					character <SPAN CLASS="esymbol">a</SPAN>:</P>
			
					<PRE>
*********************************
Calculator in reverse Polish form
*********************************
Allowable operations are:
        '/': Divide top two numbers on the stack.
        '0': Empty the stack.
        'a': Enter operand onto stack.
        '?': Help.
        '*': Multiply top two numbers on the stack.
        '+': Add top two numbers on the stack
        'q': Quit.
        '-': Subtract top two numbers on the stack.
Enter a number, followed by <return>: 3

Accumulator = 3

Next operation? a
Enter a number, followed by <return>:
					</PRE>
					
					<P>Enter a second number, for example
					<SPAN CLASS="esymbol">2</SPAN>. You can then apply any
					operation to the two operands such as minus:</P>
					
					<PRE>
...
Next operation? a
Enter a number, followed by <return>: 2

Accumulator = 2

Next operation? -

Accumulator = 1

Next operation?
					</PRE>
					
					<P>You may use the operation <SPAN CLASS="esymbol">0</SPAN> to
					clear the stack at any time. You may use
					<SPAN CLASS="esymbol">q</SPAN> to quit the program.</P>
					
					<P CLASS="tip"><B>Tip:</B> You can use the command
					<SPAN CLASS="esymbol">?</SPAN> to display the list of available
					operations.</P>
					
					<H2>Under the Hood</H2>
					
					<P>This sample shows how to leverage EiffelBase data structures
					in a simple Eiffel system. The root class 
					<SPAN CLASS="eclass">CALCULATOR</SPAN> first instantiates all 
					<I>state</I> objects, each corresponding to one possible
					operation. The state classes all inherit from
					<SPAN CLASS="eclass">STATE</SPAN>. They are: </P>
					
					<UL>
						<LI><SPAN CLASS="eclass">PLUS</SPAN>: Add stack's two top numbers.
						<LI><SPAN CLASS="eclass">MINUS</SPAN>: Substract stack's two top numbers.
						<LI><SPAN CLASS="eclass">MULTIPLY</SPAN>: Multiply stack's two top numbers.
						<LI><SPAN CLASS="eclass">DIVIDE</SPAN>: Divide stack's two top numbers.
						<LI><SPAN CLASS="eclass">EMPTY</SPAN>: Empty stack.
						<LI><SPAN CLASS="eclass">HELP</SPAN>: Prints available commands.
						<LI><SPAN CLASS="eclass">QUESTION</SPAN>: Get input from user.
						<LI><SPAN CLASS="eclass">QUIT</SPAN>: Close application.
					</UL>

					<P>Each of these classes implement the feature
					<SPAN CLASS="efeature">do_one_state</SPAN> inherited from
					<SPAN CLASS="eclass">STATE</SPAN> which performs the operation
					associated with the state. The initial state is
					<SPAN CLASS="eclass">QUESTION</SPAN> which asks for the initial
					number to put in the <I>accumulator</I>. Following states
					depend on the user input. Every descendant of
					<SPAN CLASS="eclass">STATE</SPAN> implement the feature
					<SPAN CLASS="efeature">operation</SPAN> which performs the
					corresponding stack transformation.</P>
					
					<P>The heart of the application lies in the simple feature
					<SPAN CLASS="efeature">session</SPAN> from the root class
					<SPAN CLASS="eclass">CALCULATOR</SPAN>. This feature loops
					until the user chooses to quit (by entering the character
					<SPAN CLASS="echar">q</SPAN> when prompted for the next
					operation). For each iteration the feature analyzes the
					user input and set the next state accordingly (see feature
					<SPAN CLASS="efeature">next</SPAN> from
					<SPAN CLASS="eclass">CALCULATOR</SPAN> called from
					<SPAN CLASS="efeature">session</SPAN>). It then calls
					<SPAN CLASS="efeature">action</SPAN> which will in turn
					call the feature <SPAN CLASS="efeature">do_one_state</SPAN>
					from <SPAN CLASS="eclass">STATE</SPAN> (which is
					polymorphically implemented in the state object
					corresponding to the user's input). Finally
					<SPAN CLASS="efeature">do_one_state</SPAN> will execute the
					operation associated with the state (add the two numbers
					at the top of the stack for
					<SPAN CLASS="eclass">PLUS</SPAN>, substract them for
					<SPAN CLASS="eclass">MINUS</SPAN> etc... Once the call to
					<SPAN CLASS="efeature">do_one_state</SPAN> returns</P>, the
					feature <SPAN CLASS="efeature">session</SPAN> loops and
					the algorithm starts over.</P>

				</TD>
			</TR>
		</TABLE>
		<TABLE CLASS="FOOTER">
			<TR>
				<TD>© 2003-2004 Eiffel Software. All rights reserved.</TD>
			</TR>
		</TABLE>
	</BODY>
</HTML>
