<!DOCTYPE HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">
<HTML>
	<HEAD>
		<TITLE>Using a CECIL archive</TITLE>
		<META NAME="MS-HKWD" CONTENT="Compiler">
		<LINK REL=Stylesheet HREF="../../default.css" TYPE="text/css">
	</HEAD>

	<BODY>
<h1>Using a CECIL archive</h1>
<h2>Linking the CECIL archive into a program</h2>
  The CECIL archive already incorporates the Eiffel run-time. To use the
  functions provided in the CECIL archive, simply write the C programs according
  to the CECIL specifications of ETL, and then include the CECIL archive in the
link line of your C application. This line looks like:
  <p>on Unix/linux:
  <pre>ld -o [name of your CECIL executable] [your C object files and archives]
  lib&lt;system name&gt;.a -lm</pre>
  <p class="note"><b>Note</b>: On Unix, linking with &quot;-lm&quot; is required since the Eiffel run-time
  uses the standard math libraries. You may need to link with other libraries
  (for example, on linux: with &quot;-lbsd&quot;, in MT mode with &quot;-lpthread&quot;
  (posix threads) or &quot;-lthread&quot; (solaris)).</p>
<p>&nbsp;<p>on Windows, with MS VC++:
  <pre>link [your link flags] -OUT:[name of your cecil executable] [your C
  object files and archives] lib&lt;system name&gt;.lib [other Windows
  libraries]</pre>
  <p>&nbsp;<p>on Windows with Borland:
  <pre>ilink32 -ap -c -Tpe main.obj c0w32.obj, [name of your cecil 
executable],,EIFGEN\W_code\lib&lt;system name&gt;.lib CW32 IMPORT32 OLE2w32,,</pre><p>&nbsp;<p><b><u>Notes for compiling
  CECIL C files:</u></b><br>
  The CECIL library is built automatically, which is unfortunately not
  the case of the corresponding object files of the cecil program you
  wrote.<br>
  The C flags to use are usually the same as the ones needed during the
  compilation of the generated C-code plus those which are relevant to your own
  C-code.
  <p>Typically, you will compile with your flags as below (if you are using gcc):
  <pre>gcc -c -O -I$ISE_EIFFEL/studio/spec/$PLATFORM/include -I&lt;SOME_INCLUDE_PATH&gt; -D&lt;SOME_FLAGS&gt; your_file.c</pre>
  <p>or , if you are on Windows using MS VC++:
<pre>cl -c -nologo -Ox -I$ISE_EIFFEL\studio\spec\windows\include -I&lt;SOME_INCLUDE_PATH&gt; -D&lt;SOME_FLAGS&gt; your_file.c</b></pre>
<p>or, if you are on Windows using Borland:</p>
<pre>bcc32 -c -I$ISE_EIFFEL\studio\spec\windows\include -I&lt;SOME_INCLUDE_PATH&gt; -D&lt;SOME_FLAGS&gt; your_file.c</b></pre>
<p class="sample"><b>Sample</b>: if you want to use the multithreaded facilities 
of Eiffel, you should define the EIFFEL MT flags by adding &quot;-DEIF_THREADS&quot; to 
the command line and follow the instructions of your C compiler and platform to 
find out which additional flags you may need<b>.<br>
<br>
For example:</b> on Solaris you need to add &quot;-DSOLARIS_THREADS -D_REENTRANT&quot;.<p>You can specify a Makefile in your Ace file, so that your C files will be
  compiled automatically after the Eiffel compilation and before the final
  linking. Just add at the end of your Ace file in the external clause:
  <pre>external:
	&quot;$PATH_TO_MAKEFILE/your_makefile&quot;;</pre>
  <p>This makefile will be run from the $/EIFGEN/W_code or $/EIFGEN/F_code
  directory. You should not give the CECIL executable the same name as your
  system, because it will be replaced by the Eiffel executable when you run
  another compilation.</p>
<h2>Initializing the Eiffel run-time</h2>
  Even though the main thread of control resides in the &quot;C side&quot; of
  the program, the Eiffel run-time must be initialized correctly before it can use CECIL facilities to communicate with the Eiffel world.
  <p>In the C file containing the &quot;main&quot; C function, you must add the
  following line to include the header file &quot;eif_setup.h&quot; provided
  with this example:
  
 <pre>#include &quot;eif_setup.h&quot;&nbsp; /* Macros EIF_INITIALIZE and EIF_DISPOSE_ALL */
#include &quot;eif_eiffel.h&quot; /* Exported functions of the Eiffel run-time */</pre>
  <p>Your &quot;main&quot; function must have the three standard arguments of
  the C &quot;main&quot; function: &quot;argc&quot;, &quot;argv&quot; and
  &quot;envp&quot; and include the following macros that are defined in &quot;eif_setup.h&quot;:
  
  <pre>int main(int argc, char **argv, char **envp)
	/* Please respect this signature: `argc', `argv' and `envp' are used
	 * in EIF_INITIALIZE.
	 */
{
		/* declarations of variables */
		/* Initialize the Eiffel run-time. */
	EIF_INITIALIZE(failure)

	/* body of your &quot;main&quot; function */

		/* Reclaim the memory allocated by the Eiffel run-time. */
	EIF_DISPOSE_ALL
}</pre>
  <p class="note"><b>Notes</b>:<br>
  The above mentioned macros must imperatively be in the body of
  the &quot;main&quot; function for the Eiffel exception handling mechanism to
  work correctly.<b><br>
  <br>
  </b>You also need to add the Eiffel run time directory to the list of
  directories in which the C compiler searches for include files. You can do so
  by using the &quot;-I&quot; option of your C compiler.<b><br>
  <br>
  </b> You can only link one CECIL library into your C applications at
  a time.</P>
  <p class="warning"><b>Caution</b>: Even though external object files and archives are correctly specified in the
  &quot;object&quot; clause of the Ace file, you will need to explicitly link
  them to your C application.</p>

</BODY>
</HTML>