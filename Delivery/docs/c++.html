<TITLE>Eiffel-C++ interface and Legacy++</TITLE>

<HTML>
<HEAD>
 
<link rev="made" href="mailto:webmaster@eiffel.com">
<link rel="stylesheet" href="/styles/tech.css">

<meta name="KEYWORDS" content="object-oriented, O-O, Java, Eiffel, C++, Smalltalk, software, reuse, reusability, software reuse, software reusability, logiciel, quality, contract, Design by Contract, programming by contract, contract-based engineering, BON, B.O.N., components, object-oriented analysis, object-oriented design, software components, componentware, COM, COM3, OLE, ActiveX, objet, objets, objekt, ogetto, ogetti, programmation par objets, programmation objets, programmazione per oggetti, technologie objet, technologie objets, object resource center, object technology resource center, object-oriented programming, objekt-orientierte programmierung, CORBA, OMG, CASE, Computer-Aided Software Engineering, SDK, development environment, software development kit, business modeling, Ariane 5, European Space Agency, ISE, Interactive Software Engineering, Bertrand Meyer, libraries, genie logiciel, software engineering, large-scale software engineering, object-oriented training, object-oriented consulting">


    <META NAME="GENERATOR" Content="Visual Page 1.0 for Windows">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=iso-8859-1">
</HEAD>

<BODY BGCOLOR="#F9EFE9">

<P>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="425">
      <TR>
              <TD><IMG SRC="/images/headers/ise-left.gif" WIDTH="200" HEIGHT="65" ALIGN="BOTTOM" ALT="Interactive Software Engineering: tools and components for enterprise applications"
                      BORDER="0"><IMG SRC="/images/headers/tech-right.gif" WIDTH="225" HEIGHT="65" ALIGN="BOTTOM" ALT="ISE TECHNOLOGY"
                      BORDER="0"></TD>
      </TR>
</TABLE>


<p>
<table cols="1" width="530" cellpadding="0" cellspacing="0" border="0"><tr><td>


<H1>Eiffel-C++ interface and Legacy++</H1>
<IMG SRC="/images/logos/power.gif" ALT="Eiffel Power (TM) from ISE" VSPACE="2"
ALIGN=RIGHT>
<P>
This document is appendix F to the manual
<I>Eiffel: The Environment</I>.
References to "the previous appendix" denote appendix E of
the manual, which describes the C interface.
<P>
The C++ interface and Legacy++ are part of all versions of ISE Eiffel
starting with version 4.1.
<H2>F.1 OVERVIEW</H2>
<P>
Eiffel software must interact with software written in other languages. The previous appendix
described how to access C software from Eiffel; in the present one you will learn about how
to incorporate C++ classes in your Eiffel software.
<P>
The C++ interface offers the following mechanisms:
<UL>

<P><IMG SRC="/icons/greenball.gif">
You can create instances of C++ classes from Eiffel, using the C++ "constructor" of
your choice.

<P><IMG SRC="/icons/greenball.gif">
You can apply to these objects all the corresponding operations from the C++ class:
executing functions ("methods"), accessing data members, executing destructors.

<P><IMG SRC="/icons/greenball.gif">
You can use the Legacy++ tool to produce an Eiffel "wrapper class" encapsulating all
the features of a C++ class, so that the result will look to the rest of the Eiffel software
as if it had been written in Eiffel.
</UL>
<P>

To profit best from this appendix, it will be useful to be familiar with the essentials of
the C interface as described in the preceding appendix in
<I>Eiffel: The Environment</I>.
<P>
The discussion concentrates on using C++ software from Eiffel. In the other direction,
as noted in the preceding appendix, you can use the Cecil library (C-Eiffel Call-In Library)
described in chapter 24 of
<A HREF="/doc/documentation.html#etl"><I>Eiffel: The Language</I></A>
with important complements in the
<A HREF="/doc/manuals/technology/library/cecil/page.html">on-line Cecil manual</A>
and at ftp://ftp.eiffel.com.
<P>
<H2>F.2 THE SYNTAX SPECIFICATION</H2>
<P>
In the following specification,
the syntax for <FONT COLOR="#AA00FF">External</FONT> and <FONT COLOR="#AA00FF">External_name</FONT> is
retained unchanged from <I>Eiffel: The Language</I>, where
<FONT COLOR="#AA00FF">Language_name</FONT> is defined simply as
<FONT COLOR="#AA00FF">Manifest_string</FONT>;
the rest covers the additional facilities.
<FONT COLOR="#AA00FF">
<PRE>
    External == external Language_name [External_name]

    Language_name ==
            '"'
            Basic_language_name
            [Special_external_declaration]
            [Signature]
            [Include_files]
                    '"'

    Basic_language_name == "C" | "C++"

    Special_external_declaration == "[" Special_feature "]"

    Special_feature == Special_C_feature | Special_C++_feature

    Special_C_feature == <FONT COLOR="#FF0000">... See appendix E...</FONT>

    Special_C++_feature ==
            Member_function_call|
            Static_function_call |
            Object_creation |
            Object_deletion |
            Data_member_access |

    Member_function_call == C++_Class

    C++_Class == Class_name File_name

    Class_name == Identifier

    Static_function_call == <B><FONT COLOR="#000080">static</FONT></B> C++_Class

    Object_creation == <B><FONT COLOR="#000080">new</FONT></B> C++_Class

    Object_deletion == <B><FONT COLOR="#000080">delete</FONT></B> C++_Class

    Data_member_access == <B><FONT COLOR="#000080">data_member</FONT></B> C++_Class

                <FONT COLOR="#FF0000">-- The remaining elements are repeated</FONT>
                <FONT COLOR="#FF0000">-- from the C interface specification (page 291 in <I>Eiffel: The Environment</I>).</FONT> 

    File_name ==  User_file_name | System_file_name

    User_file_name == '%"' Manifest string '%"'

    System_file_name == "<" Manifest_string ">"

    Signature ==  "(" Type_list ")" [Result_type]

    Type_list ==  {Type "," ...}

    Result_type ==  ":" Type

    Include_files ==  "|" File_list

    File_list ==  {File_name "," ...}

    External_name ==  <B><FONT COLOR="#000080">alias</FONT></B> Manifest_string
</PRE>
</FONT>
<P>
As with the C extensions of the previous appendix, the syntax description conventions are those of
<I>Eiffel: The Language</I>.  means "is defined as". The vertical bar <FONT COLOR="#AA00FF">|</FONT> separates alternative choices, such as the three
possibilities for Special_feature. The brackets <FONT COLOR="#AA00FF">[...]</FONT> enclose optional components; for example a
<FONT COLOR="#AA00FF">Language_name</FONT> is made of required quotes, a required Basic_language_name and three further
components, any or all of which may be absent. The notation <FONT COLOR="#AA00FF">{Element Separator ...}</FONT> means: 0
or more occurrences ("specimens") of <FONT COLOR="#AA00FF">Element</FONT> separated, if more than one, by <FONT COLOR="#AA00FF">Separator</FONT>.
<P>
Several of the symbols of the syntax notation, such as the brackets or the vertical bar, also appear in
the language; to avoid any confusion they are given in double quotes. For example the specification
for <FONT COLOR="#AA00FF">Include_files</FONT> begins with <FONT COLOR="#AA00FF">"|"</FONT> to indicate that an <FONT COLOR="#AA00FF">Include_files</FONT> part starts with a vertical bar. Single
quotes may be used instead of double quotes when one of the quoted characters is itself a double
quote; for example <FONT COLOR="#AA00FF">'%"'</FONT> appearing in the production for <FONT COLOR="#AA00FF">User_file_name</FONT> denotes the percent character
followed by the double quote character. Special words such as <B><FONT COLOR="#AA00FF">static</FONT></B> in bold italics stand for
themselves, unquoted.
<P>
<H2>F.3 AVAILABLE POSSIBILITIES</H2>
<P>
<H3><I>F.3.1 Processing C++ features</I></H3>
<P>
A <FONT COLOR="#AA00FF">Special_C++_feature</FONT>, if present, indicates one of the following, all illustrated by examples in
the next sections:
<UL><LI>
If the special feature's declaration simply starts with a C++ class name, followed by the
associated file name, it indicates that the Eiffel feature will call a C++ member function
(also known as a "method") from that class. The name of the member function is by
default the same as the name of the Eiffel feature; as usual, you can specify a different
name through the alias clause of the external declaration.
</LI><BR><BR><LI>
If the declaration starts with <B><FONT COLOR="#000080">static</FONT></B>, it indicates a call to a C++ static function.
</LI><BR><BR><LI>
If the declaration starts with <B><FONT COLOR="#000080">new</FONT></B>, it indicates a call to one of the constructors in the C++
class, which will create a new instance of that class and apply to it the corresponding
constructor function.
</LI><BR><BR><LI>
If the declaration starts with <B><FONT COLOR="#000080">delete</FONT></B>, it indicates a call to a destructor from the C++ class.
In this case the Eiffel class will inherit from <I>MEMORY</I> and redefine the dispose procedure
to execute the destructor operations whenever the Eiffel objects are garbage-collected.
</LI><BR><BR><LI>
If the declaration starts with <B><FONT COLOR="#000080">data_member</FONT></B>,
it indicates access to a data member (attribute
in Eiffel terminology) from the C++ class.
</LI></UL>
<P>
The rest of the possible components are the same as in the C interface:
<FONT COLOR="#AA00FF">Signature</FONT> to specify
types for arguments and results; possible <FONT COLOR="#AA00FF">Include</FONT> file.
<P>
<H3><I>F.3.2 Extra argument</I></H3>
<P>
For a non-static C++ member function or destructor, the corresponding Eiffel feature should
include an extra argument of type POINTER, at the first position. This argument represents the
C++ object to which the function will be applied.
<P>
For example, a C++ function
<PRE>
    void add (int new_int);
</PRE>
<P>
should have the Eiffel counterpart
<P>
<UL>
<I>cpp_add</I> (<I>obj: POINTER; new_int: INTEGER</I>) <B><FONT COLOR="#000080">is</FONT></B>
<UL>
<UL>
<FONT COLOR="#FF0000">-- Encapsulation of member function </FONT><I>add</I>.
</UL>
<B><FONT COLOR="#000080">external</FONT></B>
<UL>
"<I>C++</I> [<I>IntArray %</I>"<I>intarray.h%</I>"] (<I>IntArray *, int</I>)"
</UL>
<B><FONT COLOR="#000080">end</FONT></B>
</UL>
</UL>
This scheme, however, is often inconvenient because it forces the Eiffel side to work on
objects in a non-object-oriented way. (The object-oriented way treats the current object, within
a class, as implicit.) A better approach, used by Legacy++, is to make a feature such as cpp_add
secret, and to export a feature whose signature corresponds to that of the original C++ function,
with no extra object argument; that feature will use a secret attribute object_ptr to access the
object. In the example this will give the feature
<P>
<UL>
<I>add</I> (<I>new_int</I>:<I> INTEGER</I>) <B><FONT COLOR="#000080">is</FONT></B>
<UL>
<UL>
<FONT COLOR="#FF0000">-- Encapsulation of member function </FONT><I>add</I>.
</UL>
<B><FONT COLOR="#000080">do</FONT></B>
<UL>
<I>cpp_add</I> (<I>object_ptr, new_int</I>)
</UL>
<B><FONT COLOR="#000080">end</FONT></B>
</UL>
</UL>
<P>
where <I>object_ptr</I> is a secret attribute of type <I>POINTER</I>, initialized by the creation procedures
of the class. To the Eiffel developer, add looks like a normal object-oriented feature, which
takes only the expected argument. Further examples appear below.
<P>
There is no need for an extra argument in the case of static member functions, constructors
and data members.
<P>
<H2>F.4 WRAPPING C++ CLASSES: LEGACY++</H2>
<P>
Before taking a look at examples of the various facilities mentioned, it is useful to consider the
tool that will help you, in many cases, avoid worrying about their details.
<P>
<H3><I>F.4.1 The role of Legacy++</I></H3>
<P>
Often you will want to provide an Eiffel encapsulation of all the facilities -- member functions,
static functions, constructors, destructors, data members -- of a C++ class. This means
producing an Eiffel class that will provide an Eiffel feature for each one of these C++ facilities,
using external declarations based on the mechanisms listed in the preceding section.
<P>
Rather than writing these external declarations and the class structure manually, you can
use the Legacy++ tool to produce the Eiffel class automatically from the C++ class.
<P>
<H3><I>F.4.2 Calling Legacy++</I></H3>
<P>
Legacy++ is called with an argument denoting a <I>.h</I> file that must contain C++ code: one or more
classes and structure declarations. It will translate these declarations into Eiffel wrapper
classes.
<P>
The following options are available:
<UL><LI>
<B>-E</B>: apply the C preprocessor to the file, so that it will process #include, #define, #ifdef
and other preprocessor directives. This is in fact the default, so that you do not need to
specify -E explicitly (see next option).
</LI><BR><BR><LI>
<B>-NE</B>: do not apply the C preprocessor to the file.
</LI><BR><BR><LI>
<B>-p </B><I>directories</I>: use <I>directories</I> as include path.
</LI><BR><BR><LI>
<B>-c</B><I>compiler</I>: use <I>compiler</I> as the C++ compiler.
</LI><BR><BR><LI>
<B>-g</B>: treat the C++ code as being intended for the GNU C++ compiler.
</LI></UL>
<P>
<H3><I>F.4.3 Result of applying Legacy++</I></H3>
<P>
Running Legacy++ on a C++ file will produce the corresponding Eiffel classes. Legacy++
processes not only C++ classes but also C++ "structs"; in both cases it will generate an Eiffel
class.
<P>
Legacy++ knows about default specifiers: public for classes, private for structs.
<P>
Legacy++ will generate Eiffel features for member functions (static or not).
<P>
It will also handle any constructors and destructors given in the C++ code, yielding the
corresponding Eiffel creation procedures. If there is no constructor, it will produce a creation
procedure with no arguments and an empty body.
<P>
For any non-static member function or destructor, Legacy++ will generate a secret feature
with an extra argument representing the object, as explained in the preceding earlier in this
appendix. It will also produce a public feature with the same number of arguments as the C++
function, relying on a call to the secret feature, as illustrated for add and cpp_add above.
<P>
The * char type is translated into <I>STRING</I>. Pointer types, as well as reference types
corresponding to classes and types that Legacy++ has processed, will be translated into
<I>POINTER</I>. Other types will yield the type <I>UNRESOLVED_TYPE</I>.
<P>
<H3><I>F.4.4 Legacy++ limitations</I></H3>
<P>
It is up to you to supply Eiffel equivalents of all the needed types. If Legacy++ encounters the
name of a C++ class or type that is does not know -- i.e. it is neither a predefined type nor a
previously translated class -- it will use the Eiffel type name <I>UNRESOLVED_TYPE</I>. If you do
not change that type in the generated class, the Eiffel compiler will produce an error (unknown
class) at degree 5.
<P>
Legacy++ does not handle inline function declarations.
<P>
Legacy++ makes no effort to understand the C++ inheritance structure.
<P>
More generally, given the differences in the semantic models of C++ and Eiffel, Legacy++
can only perform the basic Eiffel wrapping of a C++ class, rather than a full translation. You
should always inspect the result and be prepared to adapt it manually.
<P>
Legacy++'s contribution is to take care of the bulk of the work, in particular the tedious
and repetitive parts. The final details are left to the Eiffel software developer.
<P>
<H2>F.5 AN EXAMPLE</H2>
<P>
Consider the following C++ class, which has an example of every kind of facility that one may
wish to access from the Eiffel side:
<PRE>
    class IntArray

            {

            public:

                IntArray (int size);

                ~IntArray ();

                void output ();

                void add (int new_int);

                static char * type ();

            protected:

                int *_integers;

            };
</PRE>
<P>
Here is the result of applying Legacy++ to that class, which will serve as an illustration of
both the C++ interface mechanisms and Legacy++:
<PRE>
    <B><FONT COLOR="#000080">indexing</FONT></B><I>
        description</I>:<I>
            "Eiffel encapsulation of C++ class IntArray";

        date: "$Date$";
        revision: "$Revision$"

    </I><B><FONT COLOR="#000080">class</FONT></B><I>
        INTARRAY

    </I><B><FONT COLOR="#000080">inherit</FONT></B><I>
        MEMORY
            </I><B><FONT COLOR="#000080">redefine</FONT></B><I>
                dispose
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

    </I><B><FONT COLOR="#000080">creation</FONT></B><I>
        make

    </I><B><FONT COLOR="#000080">feature</FONT></B> <FONT COLOR="#FF0000">-- Initialization</FONT><I>

        make (size: INTEGER) </I><B><FONT COLOR="#000080">is</FONT></B><I>
                </I><FONT COLOR="#FF0000">-- Create Eiffel and C++ objects.</FONT><I>
            </I><B><FONT COLOR="#000080">do</FONT></B><I>
                object_ptr := cpp_new (size)
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

    </I><B><FONT COLOR="#000080">feature</FONT></B> <FONT COLOR="#FF0000">-- Removal</FONT><I>

        dispose </I><B><FONT COLOR="#000080">is</FONT></B><I>
                </I><FONT COLOR="#FF0000">-- Delete C++ object.</FONT><I>
            </I><B><FONT COLOR="#000080">do</FONT></B><I>
                cpp_delete (object_ptr)
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

    </I><B><FONT COLOR="#000080">feature</FONT></B><I>

        output </I><B><FONT COLOR="#000080">is</FONT></B><I>
                </I><FONT COLOR="#FF0000">-- Call C++ counterpart.</FONT><I>
            </I><B><FONT COLOR="#000080">do</FONT></B><I>
                cpp_output (object_ptr)
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

        add (new_int: INTEGER) </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Call C++ counterpart.</FONT><I>
            </I><B><FONT COLOR="#000080">do</FONT></B><I>
                cpp_add (object_ptr, new_int)
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

    </I><B><FONT COLOR="#000080">feature</FONT></B> {<I>INTARRAY</I>}<I>

        underscore_integers: POINTER </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Value of corresponding C++ data member.</FONT><I>
            </I><B><FONT COLOR="#000080">do</FONT></B><I>
                Result := underscore_integers (object_ptr)
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

    </I><B><FONT COLOR="#000080">feature</FONT></B> {<I>NONE</I>} <FONT COLOR="#FF0000">-- Externals</FONT><I>

        cpp_new (size: INTEGER): POINTER </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Call single constructor of C++ class.</FONT><I>
            </I><B><FONT COLOR="#000080">external</FONT></B><I>
                "C++ [new IntArray %"INTARRAY.H%"] (EIF_INTEGER)"
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

        cpp_delete (cpp_obj: POINTER) </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Call C++ destructor on C++ object.</FONT><I>
            </I><B><FONT COLOR="#000080">external</FONT></B><I>
                    "C++ [delete IntArray %"INTARRAY.H%"] ()"
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

        cpp_output (cpp_obj: POINTER) </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Call C++ member function.</FONT><I>
            </I><B><FONT COLOR="#000080">external</FONT></B><I>
                    "C++ [IntArray %"INTARRAY.H%"] ()"
            </I><B><FONT COLOR="#000080">alias</FONT></B><I>
                    "output"
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

        cpp_add (cpp_obj: POINTER; new_int: INTEGER) </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Call C++ member function.</FONT><I>
            </I><B><FONT COLOR="#000080">external</FONT></B><I>
                    "C++ [IntArray %"INTARRAY.H%"] (EIF_INTEGER)"
            </I><B><FONT COLOR="#000080">alias</FONT></B><I>
                    "add"
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

        cpp_underscore_integers (cpp_obj: POINTER): POINTER </I><B><FONT COLOR="#000080">is</FONT></B><I>
                    </I><FONT COLOR="#FF0000">-- Value of C++ data member</FONT><I>
            </I><B><FONT COLOR="#000080">external</FONT></B><I>
                    "C++ [data_member IntArray %"INTARRAY.H%"]: EIF_POINTER"
            </I><B><FONT COLOR="#000080">alias</FONT></B><I>
                    "_integers"
            </I><B><FONT COLOR="#000080">end</FONT></B><I>

    </I><B><FONT COLOR="#000080">feature</FONT></B> {<I>NONE</I>} <FONT COLOR="#FF0000">-- Implementation</FONT><I>

            object_ptr: POINTER

    </I><B><FONT COLOR="#000080">end</FONT></B> <FONT COLOR="#FF0000">--</FONT> </I><B><FONT COLOR="#000080">class</B></FONT><I> INTARRAY</I>
</PRE>

<P ALIGN="CENTER"><IMG SRC="/images/bars/bottom.gif" WIDTH="423" HEIGHT="23" ALIGN="BOTTOM" ALT="Frequently requested pages" BORDER="0" USEMAP="#bottom"><BR>


<MAP Name="bottom">
<AREA Shape="Rect" coords = "1,4,65,21"  HREF="http://www.eiffel.com/" TARGET="_top">
<AREA Shape="Rect" coords = "67,3,111,22"  HREF="/eiffel/page.html">
<AREA Shape="Rect" coords = "112,3,177,22"  HREF="/products/page.html">
<AREA Shape="Rect" coords = "179,3,229,22"  HREF="/doc/documentation.html">
<AREA Shape="Rect" coords = "230,3,287,22"  HREF="/doc/manuals/page.html">
<AREA Shape="Rect" coords = "289,2,372,21"  HREF="/frames/new.html" target="topleft">
<AREA Shape="Rect" coords = "373,2,423,22"  HREF="/frames/alpha.html" target="topleft">
</MAP>

<FONT SIZE="-1">

<form method="post" action="/cgi-bin/htdig/htsearch">
<TABLE ALIGN="CENTER">
<TR>
<TD NOWRAP>
<FONT SIZE="-1" FACE="Arial, Helvetica, Sans-Serif">
<input type="text" size="25" name="words" value="">
<input type="submit" value="Search eiffel.com">
</FONT>
</TD>
<TD NOWRAP>
<FONT SIZE="-1" FACE="Arial, Helvetica, Sans-Serif">
Match: <select name=method>
<option value=and>All
<option value=or>Any
<option value=boolean>Boolean
</select>
</FONT>
</TD>
<TD NOWRAP>
Format: <select name=format>
<option value=builtin-long>Long
<option value=builtin-short>Short
</select>

<input type=hidden name=format value=builtin-long>
<input type=hidden name=config value=htdig>
<input type=hidden name=restrict value="">
<input type=hidden name=exclude value="">

</TD>
</TR>
</TABLE>
</form>

<CENTER>
<A HREF="mailto:info@eiffel.com">Questions? Comments? Let us know!</A>
<BR>

URL for this page: <I>http://eiffel.com/doc/manuals/language/cpp/page.html</I>
<BR>
&copy;1999 Interactive Software Engineering, Inc. All rights reserved.
</CENTER>
</FONT>

</td></tr></table>


</BODY>
</HTML>
