test_name 	 expanded-reattachment
test_description Reattachment of expanded objects should result in calling feature "copy".

-- Assignment attempt for target of expanded type is allowed only in .NET
if     DOTNET define A "?="
if not DOTNET define A ":="

copy_raw	a.e    $CLUSTER a.e
copy_sub	Ace $TEST Ace

-- Test with expanded class type

define B "expanded A"
copy_sub	test.e $CLUSTER test.e

compile_melted
compile_result	ok
execute_work	NONE exec_output_m
execute_result	ok
compare		exec_output_m output1

compile_frozen
compile_result	ok
c_compile_work
c_compile_result ok
execute_work	NONE exec_output_w
execute_result	ok
compare		exec_output_w output1

compile_final
compile_result	ok
c_compile_final
c_compile_result ok
execute_final	NONE exec_output_f
execute_result	ok
compare		exec_output_f output1

cleanup_compile

-- Test with expanded descendants

define B "B"
copy_raw	b.e    $CLUSTER b.e
copy_sub	test.e $CLUSTER test.e

compile_melted
compile_result	ok
execute_work	NONE exec_output_m
execute_result	ok
compare		exec_output_m output2

compile_frozen
compile_result	ok
c_compile_work
c_compile_result ok
execute_work	NONE exec_output_w
execute_result	ok
compare		exec_output_w output2

compile_final
compile_result	ok
c_compile_final
c_compile_result ok
execute_final	NONE exec_output_f
execute_result	ok
compare		exec_output_f output2

test_end
