<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>ISE EiffelBench</title>
<link rev="made" href="mailto:webmaster@eiffel.com">
<link rel="stylesheet" href="styles/tech.css">
</head>

<body>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="425">
      <TR>
              <TD><IMG SRC="styles/ise-left.gif" width="200" height="65" ALIGN="BOTTOM" ALT="Interactive Software Engineering: tools and components for enterprise applications"
                      BORDER="0"><IMG SRC="styles/tech-right.gif" width="225" height="65" ALIGN="BOTTOM" ALT="ISE TECHNOLOGY"
                      BORDER="0"></TD>
      </TR>
</TABLE>

<table cols="1" width="700" cellpadding="0" cellspacing="0" border="0">
<tr><td>

EiffelProfile: Analyzing the performance of Eiffel systems<br>
==========================================================<br>
<br>
1  INTRODUCTION<br>
   ------------<br>
<br>
 ISE Eiffel offers EiffelProfile, a profiling mechanism enabling Eiffel users to&nbsp;<br>
analyze the run-time properties of their systems and in particular the cost of each&nbsp;<br>
routine: number of calls, time spent.<br>
EiffelProfile is a precious tool to understand systems and optimize them.<br>
<br>
This document describes how to use EiffelProfile. It is divided into the following&nbsp;<br>
sections:<br>
<br>
·	Principles and general organization (section 2).&nbsp;<br>
·	Lace options to be included for profiling (section 3).&nbsp;<br>
·	How to instruct your software in preparation for EiffelProfile's work&nbsp;<br>
	(section 4).&nbsp;<br>
·	How to obtain, analyze and process the results of EiffelProfile (section 5).<br>
<br>
<br>
2  EIFFELPROFILE: GENERAL ORGANIZATION<br>
   -----------------------------------<br>
<br>
EiffelProfile works on the basis of one or more Execution Profiles: files containing&nbsp;<br>
information about an execution of your system, and files generated by that execution.&nbsp;<br>
EiffelProfile lets you analyze the Execution Profiles to obtain information about&nbsp;<br>
the calling and timing patterns of your system.<br>
<br>
To ensure that an execution of your system will generate an Execution Profile, you&nbsp;<br>
must compile it using an appropriate Lace option: profile. You may choose to profile<br>
the entire system, or only some specific clusters and classes.<br>
<br>
For the time analysis you can use either ISE Eiffel's own timing mechanism or an&nbsp;<br>
external profiler such as GNU's gprof or Pure Atria's Quantify.<br>
An execution of the system will generate an internal file containing the appropriate<br>
information. You then run a conversion tool to transform this file into an Execution<br>
Profile.<br>
<br>
Once you have generated one or more Execution Profiles, EiffelProfile provides you&nbsp;<br>
with a powerful query language enabling you to produce the information that you need<br>
for the purpose of your analysis.<br>
<br>
The following sections detail the steps in this process.<br>
The mechanisms of EiffelProfile exist under two interfaces: graphical, under&nbsp;<br>
EiffelBench; and command-line, under es4 -loop. This version of the manual details&nbsp;<br>
both the textual and the graphical interface; the various commands are available&nbsp;<br>
under the (P) Profile option of es4 -loop. (For a general presentation of es4 -loop&nbsp;<br>
see Eiffel: The Environment.) The EiffelBench version offers exactly the same&nbsp;<br>
facilities, in graphical form.<br>
<br>
<br>
3  LACE OPTIONS FOR INSTRUMENTING A SYSTEM<br>
   ---------------------------------------<br>
<br>
To obtain an Execution Profile you must run your system after compiling it with the<br>
appropriate Lace options. The resulting compiled version of the system is said to be<br>
instrumented, meaning that it includes special instructions that will generate the&nbsp;<br>
profiling information during execution.<br>
<br>
EiffelProfile supports two modes of profiling:<br>
<br>
·	You can use ISE Eiffel's own timing tools; this is known as internal&nbsp;<br>
	profiling.<br>
·	You can instead rely on an third-party profiling tool such as GNU's gprof.&nbsp;<br>
	This is known as external profiling.<br>
<br>
<br>
3.1  The profile option<br>
<br>
You will specify profiling through the profile option in your Ace file. The option&nbsp;<br>
is in the form of:<br>
	profile (profiler_tool)<br>
<br>
where profiler_tool indicates the desired form of profiling:<br>
·	yes for internal profiling.<br>
·	no to turn off profiling.<br>
·	For external profiling, the name of the profiler, for example "gprof". This&nbsp;<br>
must be the name of the corresponding executable, accessible through your path.<br>
<br>
<br>
3.2  Including the option<br>
<br>
For internal profiling, you can specify the profile option, like many other Lace&nbsp;<br>
options such as, trace and debug at the system, cluster or class level.<br>
Here is an example Ace using the option:<br>
system<br>
	syst1<br>
root<br>
	ROOT_CLASS (ROOT_CLUSTER): "creation_procedure"<br>
default<br>
	assertion (require);<br>
	precompiled ("$EIFFEL4/precomp/spec/$PLATFORM/base");<br>
	profile (no)<br>
cluster<br>
	root_cluster: "\x12l\x12"<br>
		default<br>
			 profile (yes)<br>
		option<br>
			profile (no): SOME_CLASS<br>
		end;<br>
	º Other clusters º<br>
end -- system syst1<br>
<br>
This turns on profiling for all classes or the root_cluster except SOME_CLASS, and&nbsp;<br>
turns it off for all other clusters (this would be the default).<br>
For external profiling, you will turn on the option, under the form profile&nbsp;<br>
(profiler_tool), at the global default. However, even if you specify it at the&nbsp;<br>
Cluster level, the Eiffel profiling will be disabled.<br>
<br>
3.3  Generated files<br>
<br>
If the profile option has been set, execution of the system will generate profiling&nbsp;<br>
information in a file which resides in one of the subdirectories of the project&nbsp;<br>
directory:<br>
<br>
·	EIFGEN|W_code in workbench mode (melting or freezing).<br>
·	EIFGEN|F_code in finalized mode.<br>
<br>
(As usual in ISE Eiffel documentation, the vertical bar | stands for the path&nbsp;<br>
delimiter: / on Unix, \ on Windows, the equivalent convention on VMS.)<br>
For internal profiling, the name of the file is profinfo. For external profiling,&nbsp;<br>
it is determined by the external profiler being used.<br>
<br>
<br>
4  PRODUCING AN EXECUTION PROFILE<br>
   ------------------------------<br>
<br>
Once an execution of an instrumented system has generated the proper file, you must<br>
process it through a profile converter to produce the Execution Profile. The need&nbsp;<br>
for the converter comes from the various formats that profilers use to record&nbsp;<br>
run-time information during an execution; a simple Profiler Configuration File&nbsp;<br>
enables you to describe the format used by any particular profiler.<br>
<br>
<br>
4.1   Setting up the Profiler Configuration File<br>
<br>
The Profiler Configuration File is a file found in the directory<br>
$EIFFEL4|bench|profiler<br>
<br>
where $EIFFEL4 is the location of the Eiffel installation. The name of the&nbsp;<br>
Profiler Configuration File in that directory is eiffel for internal profiling&nbsp;<br>
and, for external profiling, the name of the profiler tool as specified in the&nbsp;<br>
profiler option.<br>
The Profiler Configuration File describes the structure of the file generated by&nbsp;<br>
the profiler. Here is a complete example showing the various options that may be&nbsp;<br>
specified:<br>
<br>
number_of_columns: 7<br>
	-- Number of columns in the file.<br>
index_column: 1<br>
	-- Column where the index is stored.<br>
function_time_column: 3<br>
	-- Column where the time spent in the function is stored.<br>
descendent_time_column: 4<br>
	-- Column where the time spent in the descendents of a function is stored.<br>
number_of_calls_column: 5<br>
	-- Column where the number of calls to a function is stored.<br>
function_name_column: 6<br>
	-- Column where the name of the function is stored.<br>
percentage_column: 2<br>
	-- Column where the percentage of time spent in the function is stored.<br>
second_percentage_column: 0<br>
	-- Column where the second percentage of time spent in the function is&nbsp;<br>
	-- stored.<br>
generates_leading_underscore: no<br>
	-- Says whether the profiler generates leading underscores (yes) or not&nbsp;<br>
	-- (no).<br>
<br>
As in Eiffel and Lace, -- introduces a comment, which has no effect on the&nbsp;<br>
specification. If one of the xxx_column options has value 0, this means that the&nbsp;<br>
files generated by the given profiler contain no such column. The order of the&nbsp;<br>
options is not significant.<br>
<br>
<br>
4.2  Running the converter under EiffelBench<br>
<br>
To run the profile converter under EiffelBench, in the Profile tool, select in the&nbsp;<br>
Command sub-menu Generate. A new window will appear and you will have to select:<br>
<br>
* the name of the file to be converted (default: profinfo)<br>
* the compilation mode: workbench or finalized (default: workbench)<br>
* the name of the profiler tool (default: eiffel)<br>
<br>
When you have checked these three fields, click on the ok button to launch the&nbsp;<br>
conversion. This will generate an Execution Profile stored in a file with the&nbsp;<br>
extension .pfi.<br>
<br>
<br>
4.3  Running the converter under es4<br>
<br>
To run the profile converter under the command-line interface, use the (G) Generate<br>
command in the (P) Profile submenu of es4 -loop. This will generate an Execution&nbsp;<br>
Profile, stored in a file with the extension .pfi.&nbsp;<br>
<br>
When running the Generate command with no arguments, you will be prompted for the&nbsp;<br>
following information:<br>
<br>
·	Name of file to be converted (default: profinfo).<br>
·	Compilation mode: workbench or finalized (default: workbench).<br>
·	Name of profiler tool (default: eiffel).<br>
<br>
You can also type in the arguments directly without waiting to be prompted, as in<br>
command => g profinfo freeze eiffel<br>
<br>
<br>
5  THE QUERY MECHANISM UNDER EIFFELBENCH<br>
   -------------------------------------<br>
<br>
<br>
5.1  The Profile tool window<br>
<br>
The Profile tool window looks like the following:<br>
<br>
&lt;picture: profile_tool><br>
<br>
<br>
5.1.1 Setting switches<br>
<br>
&lt;picture: switches><br>
<br>
Two sets of switches can be seen. It is useful to select what kind of information&nbsp;<br>
is relevant to you.<br>
<br>
5.1.1.1 Column output switches&nbsp;<br>
<br>
Each switch turns off or on the corresponding column output. You have to toggle&nbsp;<br>
off or on depending upon what you would like to see in the result of the computation.<br>
Here is the explanations of each switch:<br>
<br>
Calls: number of calls to this feature during the execution<br>
<br>
Featurename: name of the feature<br>
<br>
Total: number of seconds accounted for by this function<br>
<br>
Self: number of seconds spent in this function itself<br>
<br>
Descendants: number of seconds spent in the descendants of this function on behalf&nbsp;<br>
	     of this function<br>
<br>
Percentage: percentage of the total running time of the program used by this&nbsp;<br>
	    function<br>
<br>
5.1.1.2 Profiled languages switches<br>
<br>
These switches enable you to specify the language to which querying should be&nbsp;<br>
applied. If you select only one language, the query result will not contain any&nbsp;<br>
information about routines written in the other language.<br>
The default is Eiffel only.<br>
<br>
<br>
5.1.2 Loading Execution Profiles<br>
<br>
&lt;picture: Input file &amp; Compilation mode><br>
<br>
The name of the Execution profile you are going to run a query on is initially set&nbsp;<br>
to profinfo.pfi.<br>
The input file compilation mode is initially set to workbench. Select the correct&nbsp;<br>
compilation mode and you need not worry about the location of the selected Execution&nbsp;<br>
Profile. However, if you want to specify a file that is neither in EIFGEN|W_code&nbsp;<br>
nor EIFGEN|F_code, you are able do this by clicking on the Browse button.<br>
You may also use wildcards, such as ? and *, to select more than one Execution&nbsp;<br>
profile.<br>
<br>
<br>
5.2  Running a query<br>
<br>
&lt;picture: query_form><br>
<br>
When running a query, you are able to type a complete query. After pressing the Run&nbsp;<br>
button, a new window will be displayed to show the result of the query.&nbsp;<br>
The total query can be either a single one or a set of subqueries separated by&nbsp;<br>
one of the two operators 'or' or 'and'.<br>
<br>
Each subquery must have the following syntax<br>
	attribute operator value<br>
<br>
where attribute is one of:<br>
	featurename<br>
	calls<br>
	total<br>
	self<br>
	descendants<br>
	percentage<br>
<br>
operator is one of:<br>
	&lt;, >, &lt;=, >=, =, /=. in<br>
<br>
and value is one of:<br>
	An integer (for calls)<br>
	A string (for featurename). The string may contain wild card characters: ?,&nbsp;<br>
		standing for arbitrary characters, and *, standing for arbitrary&nbsp;<br>
		substrings.<br>
	A real value (for other attributes)<br>
	An interval, of the form a-b for two values a and b.<br>
	max<br>
	min<br>
	avg<br>
<br>
<br>
5.3  Viewing the result in the Profile query window<br>
<br>
The query result window looks like<br>
&lt;picture: profile query window><br>
<br>
Note: all features, classes and clusters are still clickable in this screen.<br>
<br>
<br>
5.3.1 Refining queries<br>
<br>
The following mechanisms enable you to specify more precisely what type of&nbsp;<br>
information is relevant.<br>
<br>
5.3.1.1 Adding subqueries<br>
<br>
To refine your search, you are able to run subqueries. First, type a query.&nbsp;<br>
This query must follow the query syntax. When you are ready, press one of the 'and'&nbsp;<br>
or 'or' buttons. This sets the boolean operator that will be added beetween the&nbsp;<br>
active query and the new subquery you are adding. The result is then computed and&nbsp;<br>
displayed when you press the Run button.<br>
<br>
5.3.1.2 Changing operators<br>
<br>
You are able to change subquery operators. To do so, select one or more&nbsp;<br>
subqueries, either in the active query or in the inactive subqueries list. Then,&nbsp;<br>
press the AND button to set selected subqueries operators to 'and', or the OR&nbsp;<br>
button to set selected subqueries operators to 'or'.&nbsp;<br>
Once you have changed some operators, press the Run button to see the result of the&nbsp;<br>
new active query.<br>
<br>
5.3.1.3 Inactivating subqueries<br>
<br>
An inactivate subquery will not be taken into account during the computation of the<br>
result.&nbsp;<br>
To inactivate one or more subqueries, select them in the active query by clicking&nbsp;<br>
once, and then press the right arrow button.<br>
Once you have inactivated subqueries, press the Run button to see the result of the<br>
new active query.<br>
<br>
5.3.1.4 Reactivating subqueries<br>
<br>
You are able to reactivate a subquery that you may have inactivated before. To do so&nbsp;<br>
select one or more subqueries in the inactive subqueries list, and then press the&nbsp;<br>
left arrow button.<br>
Once you have reactivated subqueries, press the Run button to see the result of the<br>
new active query.<br>
<br>
5.3.2 Running the new active query<br>
<br>
Once you have modified the active query, by adding subqueries, changing subquery&nbsp;<br>
operators, inactivating subqueries or reactivating other ones, you can see the&nbsp;<br>
result by clicking on the Run button. The result is computed and then displayed in&nbsp;<br>
the text area.<br>
<br>
5.4  Saving the result<br>
<br>
You are able to save the result of the current query at any time by&nbsp;<br>
clicking on the Save button.<br>
<br>
<br>
6  THE QUERY MECHANISM IN COMMAND-LINE MODE<br>
   ----------------------------------------<br>
<br>
By now you have at least one Execution Profile. EiffelProfile allows you to run a&nbsp;<br>
number of useful queries on the information it contains. The queries are all&nbsp;<br>
commands of the (G) Generate submenu or es4 -loop.<br>
<br>
<br>
6.1  Basic profiler menu<br>
<br>
The Profile menu (obtained by selecting (G) Generate) looks like this:<br>
<br>
	(S) Switches<br>
	(U) Query<br>
	(I) Input<br>
	(L) Language<br>
	(R) Run<br>
	(G) Generate<br>
	(E) Defaults<br>
<br>
In the actual system, this submenu and subsequent ones contain supplementary help&nbsp;<br>
information which will be omitted.<br>
The (G) Generate submenu has already been studied; we will now review the others.&nbsp;<br>
Type (U) at any time to go to the parent menu of the current menu.<br>
<br>
<br>
6.2  Setting switches<br>
<br>
The (S) Switches submenu enables you to set global options. It leads you to the&nbsp;<br>
following set of choices:<br>
<br>
	(N) Calls<br>
	(F) Feature name<br>
	(T) Total<br>
	(S) Self<br>
	(D) Descendants<br>
	(P) Percentage<br>
Each one of these commands switches on or off the corresponding column output.  The&nbsp;<br>
default is set on for the first two, off for the others. To enable or disable a column,<br>
type the name with a toggle effect.<br>
<br>
<br>
6.3  Defining queries<br>
<br>
The (U) Query submenu enables you to define a set of queries. The result will be a&nbsp;<br>
Total Query; by default it is the boolean and all the queries you have entered&nbsp;<br>
individually, but you may deactivate some of these and choose other boolean&nbsp;<br>
operators.<br>
<br>
The (U) Query submenu takes you to the following set of choices:<br>
<br>
	(A) Add<br>
	(I) Inactivate<br>
	(R) Reactivate<br>
	(C) Operator<br>
	(S) Show<br>
<br>
To get useful information, you should add the appropriate queries through (A) Add. Each individual query has the following form:<br>
	attribute operator value<br>
<br>
where attribute is one of:<br>
	featurename<br>
	calls<br>
	total<br>
	self<br>
	descendants<br>
	percentage<br>
<br>
operator is one of:<br>
	&lt;, >, &lt;=, >=, =, /=, in<br>
<br>
and value is one of:<br>
	An integer (for calls)<br>
	A string (for featurename). The string may contain wild card characters:\x11?, standing for arbitrary characters, and *, standing for arbitrary substrings.<br>
	A real value (for other attributes)<br>
	An interval, of the form a-b for two values a and b.<br>
	max<br>
	min<br>
	avg<br>
<br>
The (S) Show command will display the current queries, each with an associated&nbsp;<br>
number. The output includes the total query, explained next.<br>
<br>
To inactivate a query, use (I) Inactivate. You will be prompted for a query index,<br>
which you may retrieve from (S) Show. This is useful if you make a change about a&nbsp;<br>
query, or want to set it aside for future use.<br>
<br>
To reactivate a query, use (R) Reactivate. Again you will have to provide a query&nbsp;<br>
index.<br>
The Total Query resulting from a succession of (A) Add commands, possibly with&nbsp;<br>
some (I) Inactivate and (R) Reactivate commands, is a boolean query resulting by&nbsp;<br>
default from adding all the currently active queries. For example after the&nbsp;<br>
following set of commands (note that command a outputs help lines, which have&nbsp;<br>
been skipped here):<br>
<br>
Command => a<br>
	--> Subquery: featurename = put*<br>
Command => a<br>
	--> Subquery: calls = 3<br>
			-- Here we change our mind and deactivate the second query<br>
			-- to replace it by calls = 3:<br>
Command => s<br>
	All subqueries:<br>
		[1] featurename = put* is active<br>
		[2] calls = 3 is active<br>
		The total active query:<br>
			featurename = put* and<br>
			calls > 5<br>
Command => i<br>
	--> Subquery index: 2<br>
Command => a<br>
	--> Subquery: calls > 5<br>
<br>
The (S) Show command will show the following result:<br>
<br>
Command => s<br>
	All subqueries:<br>
		[1] featurename = put* is active<br>
		[2] calls = 3 is active<br>
		[3] calls > 5 is active<br>
		The total active query:<br>
			featurename = put* and<br>
			calls > 5<br>
<br>
To change the boolean operator to 'or' rather than 'and', use the (C) Operator&nbsp;<br>
command. It will prompt you for the index of the operator and the new value:<br>
<br>
Command => c<br>
	--> Operator index followed by operator ('and' or 'or'): 1 or<br>
Command => s<br>
	All subqueries:<br>
		[1] featurename = put* is active<br>
		[2] calls = 3 is active<br>
		The total active query:<br>
			featurename = put* or<br>
			calls > 5<br>
<br>
6.4  Loading Execution Profiles<br>
<br>
The (I) Input command serves to load Execution Profiles. It is initially set to<br>
*.pfi<br>
meaning that it will load all files with extension pfi. By calling the command&nbsp;<br>
repeatedly with new arguments, you are able to load more Execution Profiles.<br>
If you use the command without any argument, and the set of input files contained&nbsp;<br>
just one file, then the queries will use the last generated output. This avoids&nbsp;<br>
explicitly loading a file.<br>
<br>
6.5  Selecting profiled languages<br>
<br>
The (L) Language command enables you to specify the languages to which profiling&nbsp;<br>
should be applied. You can specify Eiffel only, C only, or both. If you specify&nbsp;<br>
only one language, the query results will not contain any information about&nbsp;<br>
routines written in the other language.<br>
The default is Eiffel only. To switch to both Eiffel and C, use<br>
Command => l eiffel and c<br>
To return to just Eiffel, simply type l.<br>
<br>
6.6  Running queries<br>
<br>
To run the current total query, use (R) Run.<br>

</td></tr></table>
</body>

</html>
