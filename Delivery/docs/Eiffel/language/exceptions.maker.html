<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<TITLE>Exceptions</TITLE>
<link rev="made" href="mailto:webmaster@eiffel.com">
<link rel="stylesheet" href="../../styles/tech.css" type="text/css">
<meta name="Microsoft Border" content="t, default">
</head>

<body><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><table border="0" cellspacing="0" cellpadding="0" width="100%">
  <tr>
    <td valign="top" bgcolor="#000063" width="291"><b><font face="Arial" size="4" color="#FFFFFF">Interactive<br>
      Software Engineering</font></b></td>
    <td valign="top" bgcolor="#000063" width="720"><b><font face="Arial" size="6" color="#FFFFCC">Exceptions</font></b></td>
  </tr>
  <tr>
    <td colspan="2" valign="top" width="100%">
<p align="right"><nobr>[&nbsp;<a href="../../index.html">Home</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../../release_notes.html">Release&nbsp;Notes</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../../papers/index.html">Technology&nbsp;Papers</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../../install.html">Installation&nbsp;Notes</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../index.html">About&nbsp;Eiffel</a>&nbsp;]</nobr>
    </td>
  </tr>
</table></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><!--msnavigation--><td valign="top"><table cols="1" cellpadding="5" cellspacing="0" border="0">
<tr><td>

<H2><A NAME="HDR0"></A>6 EXCEPTIONS</H2>

<P>Whenever there is a contract, the risk exists that someone will break
it. This is where exceptions come in. </P>

<P>Exceptions -- contract violations -- may arise from several causes.
One is assertion violations, if assertions are monitored. Another is the
occurrence of a signal triggered by the hardware or operating system to
indicate an abnormal condition such as arithmetic overflow or lack of memory
to create a new object. </P>

<P>Unless a routine has made specific provision to handle exceptions, it
will <B>fail</B> if an exception arises during its execution. Failure of
a routine is a third cause of exception: a routine that fails triggers
an exception in its caller. </P>

<P>A routine may, however, handle an exception through a <B><FONT COLOR="#0000FF">rescue
</FONT></B>clause. This optional clause attempts to &quot;patch things
up&quot; by bringing the current object to a stable state (one satisfying
the class invariant). Then it can terminate in either of two ways: </P>

    <ul>
      <li>The <B><FONT COLOR="#0000FF">rescue </FONT></B>clause may execute a
<B><FONT COLOR="#0000FF">retry </FONT></B>instruction, which causes the
routine to restart its execution from the beginning, attempting again to
fulfil its contract, usually through another strategy. This assumes that
the instructions of the <B><FONT COLOR="#0000FF">rescue </FONT></B>clause,
before the <B><FONT COLOR="#0000FF">retry </FONT></B>, have attempted to
correct the cause of the exception. <BR>
      </li>
      <li>If the <B><FONT COLOR="#0000FF">rescue </FONT></B>clause does not end
with <B><FONT COLOR="#0000FF">retry </FONT></B>, then the routine fails:
it returns to its caller, immediately signaling an exception. (The caller's
<B><FONT COLOR="#0000FF">rescue </FONT></B>clause will be executed according
to the same rules.) <BR>
      </li>
    </ul>

<P>The principle is that <B>a routine must either succeed or fail</B>:
either it fulfils its contract, or it does not; in the latter case it must
notify its caller by triggering an exception. </P>

<P>Usually, only a few routines of a system will include explicit <B><FONT COLOR="#0000FF">rescue
</FONT></B>clauses. An exception occurring during the execution of a routine
with no <B><FONT COLOR="#0000FF">rescue </FONT></B>clause will trigger
a predefined rescue procedure, which does nothing, and so will cause the
routine to fail immediately, propagating the exception to the routine's
caller. </P>

<P>An example using the exception mechanism is a routine <I>attempt_transmission</I>
which tries to transmit a message over a phone line. The actual transmission
is performed by an external, low-level routine <I>transmit</I>; once started,
however, <I>transmit</I> may abruptly fail, triggering an exception, if
the line is disconnected. Routine <I>attempt_transmission</I> tries the
transmission at most 50 times; before returning to its caller, it sets
a boolean attribute <I>successful</I> to <B><I>true </I></B>or <B><I>false
</I></B>depending on the outcome. Here is the text of the routine: </P>

    <ul>
<DL>
<DT><I>attempt_transmission </I>(<I>message: STRING</I>)<I> </I><B><FONT COLOR="#0000FF">is
</FONT></B></DT>

<DL>
<DL>
<DL>
<DT><FONT COLOR="#FF0000"><I>-- </I>Try to transmit </FONT><I><FONT COLOR="#000000">message</FONT></I><FONT COLOR="#FF0000">,
at most 50 times. </FONT></DT>

<DT><FONT COLOR="#FF0000">-- Set </FONT><FONT COLOR="#000000"><I>successful</I>
</FONT><FONT COLOR="#FF0000">accordingly. </FONT></DT>
</DL>
</DL>

<DD><B><FONT COLOR="#0000FF">local </FONT></B></DD>

<DL>
<DD><I>failures: INTEGER </I></DD>
</DL>

<DD><B><FONT COLOR="#0000FF">do </FONT></B></DD>

<DL>
<DD><B><FONT COLOR="#0000FF">if </FONT></B><I>failures &lt; 50 </I><B><FONT COLOR="#0000FF">then
</FONT></B></DD>

<DL>
<DD><I>transmit (message); successful := </I><B><FONT COLOR="#0000FF">true
</FONT></B></DD>
</DL>

<DD><B><FONT COLOR="#0000FF">else </FONT></B></DD>

<DL>
<DD><I>successful := </I><B><FONT COLOR="#0000FF">false </FONT></B></DD>
</DL>

<DD><B><FONT COLOR="#0000FF">end </FONT></B></DD>
</DL>

<DD><B><FONT COLOR="#0000FF">rescue </FONT></B></DD>

<DL>
<DD><I>failures := failures + 1; </I><B><FONT COLOR="#0000FF">retry </FONT></B></DD>
</DL>

<DD><B><FONT COLOR="#0000FF">end </FONT></B></DD>
</DL>
</DL>
    </ul>

<P>Initialization rules ensure that <I>failures</I>, a local entity, is
set to zero on entry. </P>

<P>This example illustrates the simplicity of the mechanism: the <B><FONT COLOR="#0000FF">rescue
</FONT></B>clause never attempts to achieve the routine's original intent;
this is the sole responsibility of the body (the <B><FONT COLOR="#0000FF">do
</FONT></B>clause). The only role of the <B><FONT COLOR="#0000FF">rescue
</FONT></B>clause is to clean up the objects involved, and then either
to fail or to retry. </P>

<P>This disciplined exception mechanism is essential for software developers,
who need protection against unexpected events, but cannot be expected to
sacrifice safety and simplicity to pay for this protection. </P>

<center>
<P><A HREF="assertions.maker.html"><IMG SRC="fm2html-previous.gif" HEIGHT=16 WIDTH=16></A> <A HREF="BOOK.maker.html"><IMG SRC="fm2html-toc.gif" HEIGHT=16 WIDTH=16></A> <A HREF="genericity.maker.html"><IMG SRC="fm2html-next.gif" HEIGHT=16 WIDTH=16></A>
</center>
  </td></tr></table>&nbsp;<!--msnavigation--></td></tr><!--msnavigation--></table></BODY>
</HTML>
