<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Xebra Tutorial</title>
<style type="text/css">
<!--
body,td,th {
	font-family: Geneva, Arial, Helvetica, sans-serif;
	font-size: 16px;
	color: #333333;
}
h1 {
	color: #000099;
}
h2 {
	color: #003399;
}
h3 {
	color: #0033FF;
}
.code {
	font-family: "Courier New", Courier, monospace;
	font-size: 17px;
	font-style: normal;
	font-weight: bold;
	color: #000000;
}
-->
</style>
</head>

<body>
<h1>Xebra Tutorial</h1>
<p>Eiffel source is expected to be in <span class="code">$EIFFEL_SRC,</span> and the c libraries are expected to be compiled</p>
<h2 align="left">Checkout</h2>
<ul>
  <li>Checkout xebra from <a href="https://svn.origo.ethz.ch/eiffelstudio/trunk/Src/framework/web/xebra/" class="code">https://svn.origo.ethz.ch/eiffelstudio/trunk/Src/framework/web/xebra/</a> to <span class="code">$XEBRA_DEV</span></li>
</ul>
<h2>Setup mod_xebra </h2>
<ul>
  <li>  Download apache unix source httpd-2.2.11 from <span class="code"><a href="http://httpd.apache.org/download.cgi">http://httpd.apache.org/download.cgi</a></span><a href="http://httpd.apache.org/download.cgi"><br />
    <br />
  </a></li>
  <li> Extract <br />
    <br />
  </li>
  <li> Compile and install apache<br />
    lets say <span class="code">$APACHE2 </span>points to <span class="code">/home/fabioz/apache2</span><br />
    (see here for installation: <a href="http://httpd.apache.org/docs/2.2/install.html">Install</a> ). Run the following command:<br />
    <span class="code">CFLAGS=&quot;-ggdb&quot; ./configure --prefix=/home/fabioz/apache2</span><br />
    with CFLAGs you can add compiler flags like -ggdb (which generates debug information for gdb)<br />
    then run<br />
    <span class="code"><strong>make</strong><br />
  <strong>make install</strong></span><br />
  <br />
  </li>
  <li> Compile the module by running<br />
    <span class="code"><strong>cd $XEBRA_DEV/c_projects/mod_xebra</strong><br />
    <strong>$APACHE2/bin/apxs -c -Wc,-ggdb -I$EIFFEL_SRC/C/run-time -I$EIFFEL_SRC/C/run-time/include mod_xebra.c mod_xebra.h</strong></span><br />
    <br />
  </li>
  <li> Install the module to apache by running<br />
    <span class="code">sudo <strong>$APACHE2/bin/</strong>apxs -i mod_xebra.la</span><br />
    <br />
  </li>
  <li> Add the following lines to <span class="code"><strong>$APACHE2</strong>/conf/httpd.conf</span>:<br />
    <span class="code">LoadModule xebra_module <strong>$APACHE2</strong>/modules/mod_xebra.so</span><br />
    <span class="code">AddHandler mod_xebra .xeb<br />
    XebraServer_port &quot;3490&quot;<br />
  XebraServer_host &quot;localhost&quot;</span><br />
  <span class="code">LogLevel debug</span><br />
  <br />
  </li>
  <li> Restart apache (if necessary, you need to stop and start instead of restart)<br />
    <span class="code">sudo <strong>$APACHE2/bin/</strong>apachectl restart</span><br />
    <br />
  </li>
  <li> Hint: keep an eye on the apache error log<br />
    <span class="code">tail -f <strong>$APACHE2</strong>/logs/error_log</span></li>
</ul>
<p>&nbsp;</p>
<h2>Run the Xebra Server</h2>
<ul>
  <li>Open the eiffel project <span class="code">$XEBRA_DEV/eiffel_projects/xebra_server/xebra_server.ecf</span></li>
  <li>Compile and Run</li>
</ul>
<h2>Create the Web Application</h2>
<ul>
  <li>Create a new eiffel project at <span class="code">$WEBAPP</span> with the name <span class="code">xebrawebapp</span></li>
</ul>
<ul>
  <li>Include the following clusters (all in <span class="code">$XEBRA_DEV/eiffel_projects/</span>): xebra_base, thread_utilities<br />
    <br />
  </li>
  <li>Create a new folder: <span class="code">$WEBAPP/servlet_gen</span><br />
  <br />  
    <br />
  </li>
  <li>Create a file <span class="code">$WEBAPP/hello.xeb</span> with the following content<br />
    <span class="code">&lt;html&gt;<br />
&lt;body&gt;<br />
Hello &lt;xeb:call feature=&quot;world&quot;/&gt;!<br />
&lt;/body&gt;<br />
&lt;/html&gt;</span><br />
  <br />
  </li>
  <li>Create a new class in the eiffel project <span class="code">XEBRAWEBAPP_CONTROLLER</span> that inherits from <span class="code">XWA_CONTROLLER</span> and add the following two features<br />
    <span class="code">world: STRING<br /> 
    do<br />
    Result := &quot;World&quot;<br />
  end</span><br />
  <br />
  <span class="code">on_page_load<br />
  do<br />
  end</span><br />
    <br />
  </li>
  <li>Add the following creation procedure<br />
    <span class="code">make<br />
    do<br />
    base_make<br />
    end</span><br />
    <br />
  </li>
  <li>Change the root class to <span class="code">XEBRAWEBAPP_SERVER_CONN_HANDLER<br />
    <br />
  </span></li>
  <li>Adapt the three files <span class="code">generate-webapp.sh,</span> <span class="code">input_servlet_gen.txt</span> and <span class="code">input_translator.txt</span> in <span class="code">$XEBRA_DEV/eiffel_projects/xebra_translator/</span> by replacing &quot;<span class="code">demoapplication</span>&quot; with &quot;<span class="code">xebrawebapp</span>&quot;<br />
    Run <br />
    <span class="code">cd $XEBRA_DEV/eiffel_projects/xebra_translator/</span><br />
    <span class="code">./generate-webapp.sh xebrawebapp</span><br />
    If there are no errors, the files are generated to <span class="code">$WEBAPP</span>.<br />  
    <br />
  </li>
  <li>Create the folder <span class="code">$APACHE2/htdocs/xebrawebapp<br />
    <br />
  </span></li>
  <li>Compile and Run the new eiffel project</li>
</ul>
<p>&nbsp;</p>
<h2>See the Web Application</h2>
<ul>
  <li>Make sure no other apache is running.<br />
    <br />
  </li>
  <li>Browse to <span class="code"><a href="http://localhost/xebrawebapp/hello.xeb">http://localhost/xebrawebapp/hello.xeb</a></span><br />
    <br />
  </li>
</ul>
<h2>Help</h2>
<ul>
  <li>If there is a 404, apache is not running correctly or mod_xebra was not installed correctly. Also, maybe you missed the <span class="code">AddHandler mod_xebra .xeb</span> command.</li>
  <li>If there is the Fail Whale, mod_xebra could not connect to Xebra Server or a smiliar error. Consult the apache error log.</li>
</ul>
<p><br />
</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</body>
</html>
