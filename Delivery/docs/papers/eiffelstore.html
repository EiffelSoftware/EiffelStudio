<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>EiffelStore</title>
<link rel="stylesheet" href="../styles/tech.css" type="text/css">

<meta name="Microsoft Border" content="t, default">
</head>

<body><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><table border="0" cellspacing="0" cellpadding="0" width="100%">
  <tr>
    <td valign="top" bgcolor="#000063" width="291"><b><font face="Arial" size="4" color="#FFFFFF">Interactive<br>
      Software Engineering</font></b></td>
    <td valign="top" bgcolor="#000063" width="720"><b><font face="Arial" size="6" color="#FFFFCC">EiffelStore</font></b></td>
  </tr>
  <tr>
    <td colspan="2" valign="top" width="100%">
<p align="center">[<a href="http://eiffel.com">ISE Home</a>] <nobr>[&nbsp;<a href="../index.html">Home</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../release_notes.html">Release&nbsp;Notes</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="index.html">Technology&nbsp;Papers</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../install.html">Installation&nbsp;Notes</a>&nbsp;]</nobr> <nobr>[&nbsp;<a href="../Eiffel/index.html">About&nbsp;Eiffel</a>&nbsp;]</nobr>
<hr>

    </td>
  </tr>
</table></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><!--msnavigation--><td valign="top">

<h1><a name="TOP">INTRODUCTION</a></h1>
<p>In this documentation, we will describe how to use the EiffelStore library in
an Eiffel project.</p>
<p>This library provides a consistent set of classes for writing object oriented Eiffel applications that need&nbsp;to handle persistent objects.</p>
<p>Before using EiffelStore, we suggest that you read this documentation.</p>
<ul>
  <li><a href="#tech_info">Technical Information</a></li>
  <li><a href="#GetStart">Getting started</a></li>
  <li><a href="#Ace">How to configure your Ace file.</a></li>
  <li><a href="#connectData">How connect your Database</a></li>
  <li><a href="#query">How to realize a Basic query</a></li>
  <li><a href="#Examples">Some working examples</a>
    <ol>
      <li><a href="#Esql">esql</a></li>
      <li><a href="#Select">select</a></li>
      <li><a href="#Insert">insert</a></li>
      <li><a href="#Nesting">nesting</a></li>
      <li><a href="#Rm2oom">rm2oom</a></li>
      <li><a href="#Oo2rm">oom2rm</a></li>
      <li><a href="#Convert">convert</a></li>
    </ol>
  </li>
  <li>
  <a href="../pdf/store_body.pdf">PDF documentation</a>
  </li>
</ul>
<p>&nbsp;</p>
<h1><a name="tech_info">Technical Information</a></h1>
<p>The library interface consists of two sets:</p>
<ol>
  <li>A set of general purpose classes designed regardless of any data management system used,
    found in directory
: $EIFFEL5/library/store/interface, and that you always need in your universe</li>
  <li>Specific classes, referred to by the interface classes, bridging the application to selected data management systems called
&quot;handles''.</li>
</ol>
<p>&nbsp;<br>
  The set of handles may be found:</p>
<ul>
  <li>in directory $EIFFEL5/library/store/dbms</li>
  <li>in directory $EIFFEL5/library/store/dbms/rdbms/{server_name}&nbsp;<br>
    where {server_name} correspond to a selected relational database&nbsp;<br>
   management system.</li>
</ul>
<p>   Additional support classes are also needed in your universe regardless of the selected handle. They are located in:</p>
<ul>
  <li>directory $EIFFEL5/library/store/support and $EIFFEL5/library/store/dbms/support</li>
</ul>
<p>Example classes are located in:</p>
<ul>
  <li>&nbsp;$EIFFEL5/examples/store</li>
</ul>
<p>You can find the user's manual of our previous version of EiffelStore (mostly
up-to-date) in pdf format by clicking here. (This manual is more useful more experiments
users)&nbsp;</p>
<p>Our library has been successfully tested with :</p>
<ul>
  <li>ODBC 3.0</li>
  <li>Oracle 8.04&nbsp;</li>
  <li>Oracle 8i Entreprise Edition.</li>
</ul>
<p>However you should be able to use it with Sybase and OpenIngres. As far as
ISE's support is concerned we currently only guarantee support for ODBC and
Oracle. Users who want to use Sybase or OpenIngres can still do so, but in the
past couple of years we have removed them from our officially supported
platforms, due essentially to insufficient number of users.</p>
<p>In order to work with EiffelStore you also need to get <a href="eiffeltime.html">EiffelTime</a>
library.</p>
<p>&nbsp;</p>
<h1><a name="GetStart">Getting Started</a></h1>
<p>We provide you the necessary files to compile an EiffelStore project. They should be located in the directory $EIFFEL5\library\store\spec\$PLATFORM\lib (for Unix) and $EIFFEL5\library\store\spec\$COMPILER\lib two C libraries objects.</p>

<p>If the required files are not installed, please the following steps:</p>
<p>Before starting the compilation of the C libraries:</p>
<ul>
  <li>Make sure the environment variables EIFFEL5 and PLATFORM are set.</li>
  <li>Make sure that the Database you have chosen is installed</li>
  <li>Install the C library for the EiffelTime library, click <a href="eiffeltime.html#GetStart">here</a>
    to have the instructions on how to build it.</li>
</ul>
<p>Now, you can installl the C libraries. We will describe below the procedure
for both Windows and Unix:</p>
<ul>
  <li>On Windows: type &quot;<b>make_msc</b>&quot; or &quot;<b>make_bcc</b>&quot;&nbsp;
    (Depending which C compiler you are using msc for
    Microsoft, bcc for Borland) in the following directories:
    <ul>
      <li>$EIFFEL5/library/store/Clib</li>
      <li>$EIFFEL5/library/store/dbms/rdbms/(<i>your_Database</i>)/Clib</li>
    </ul>
<p>Where <i>your_Database</i> is the database you have chosen (Oracle, ODBC,
Sybase or Ingres)</p>
    
  </li>
</ul>
<ul>
  <li>On Unix: type &quot;<b>finish_freezing</b> -library&quot; in the following
    directories:</li>
    <ul>
      <li>$EIFFEL5/library/store/Clib</li>
      <li>$EIFFEL5/library/store/dbms/rdbms/(<i>your_Database</i>)/Clib&nbsp;</li>

<p>Where <i>your_Database</i> is the database you have chosen (Oracle, ODBC,
Sybase or Ingres)</p>
</ul>
</ul>    
<p>Congratulation, your EiffelStore library has been successfully installed.

<p>Now you can start a new Eiffel Project using EiffelStore.</p>
<h1><a name="Ace">How to configure your Ace file</a></h1>
<p>In order to use EiffelStore in an Eiffel Project, you have to include in your
project, the right clusters and the right external files. Thus, you need to
configure your Ace file.</p>
<p>
You can get all the information about Ace files <a href="lace.html">here</a>.</p>
<p>You have to include EiffelStore clusters and <a href="eiffeltime.html"> EiffelTime</a> clusters.</p>
<p>To include the EiffelStore cluster you have to :</p>
<ul>
  <li>Include&nbsp; these clusters one by one:&nbsp;<b><br>
    estore_support: &quot;$EIFFEL5\library\store\support&quot;;<br>
    estore_interface: &quot;$EIFFEL5\library\store\interface&quot;;<br>
    estore_db_support: &quot;$EIFFEL5\library\store\dbms\support&quot;;
    </b></li>
</ul>
<p>THEN</p>
<p>You have to include the cluster referring to your database:</p>
<ul>
  <li>For Oracle : <b>estore_oracle: &quot;$EIFFEL5\library\store\dbms\rdbms\oracle&quot;;</b></li>
  <li>For ODBC: <b>estore_odbc: &quot;$EIFFEL5\library\store\dbms\rdbms\odbc&quot;;</b></li>
</ul>
<p>In order to work with EiffelStore you need the <a href="eiffeltime.html">EiffelTime</a>
library installed. And so, you need to include its cluster in your Ace file:</p>
<p><b>time: &quot;$EIFFEL5\library\time&quot;;<br>
time_format(time): &quot;$\format&quot;;<br>
english_format(time_format): &quot;$\english&quot;;</b></p>
<p>You now have to include all the external files.</p>
<ul>
  <li><i><u>For Oracle:</u></i></li>
</ul>
<p>You have to include the oci libraries and the C EiffelStore Files. :&nbsp;<br>
<b>include_path: &quot;$(ORACLE_HOME)\OCI\Include&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$EIFFEL5\library\store\dbms\rdbms\oracle\Clib&quot;;</b></p>
<p>And to include the Oci.lib,oracle_store.lib, datetime.lib and support.lib
objects:<br>
<b>objects: &quot;$(ORACLE_HOME)\OCI\lib\msvc\oci.lib&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\oracle_store.lib&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\datetime.lib&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\support.lib&quot;;</b></p>
<p><u>Remark:</u> This description is valid only under Windows, if you use Unix, the objects are
: <b>libsupport.a, liboracle.a, libdatetime.a</b> .<br>
Moreover, the first command which include the OCI C library should be : <b>&quot;-L$(ORACLE_HOME)/lib
-lclntsh&quot;</b></p>
<ul>
  <li><i><u>For Odbc:</u></i></li>
</ul>
<p>You only need to include the odbc32.lib,odbc_store.lib, datetime.lib,
support.lib objects and the C EiffelStore files.<br>
<b>include_path: &quot;$EIFFEL5\library\store\dbms\rdbms\oracle\Clib&quot;;<br>
</b><br>
<b>objects: &quot;<i>your_path</i>\odbc32.lib&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\odbc_store.lib&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\datetime.lib&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\support.lib&quot;;</b></p>
<p>Now your Ace file should be configured. However here you can see the Ace file
of the Insert example, working with Oracle under Windows. (Check the Ace of the examples if
you need to see other Ace file).</p>
<center>
<table border="0">
  <tr>
    <td bgcolor="#FFFFE6">
<pre align="left"><b>System</b> inserter
<b>&nbsp;&nbsp;&nbsp;</b>
<b>root</b>
	inserter (root_cluster): &quot;make&quot;</pre>

<pre align="left"><b>default</b>
	<b>assertion</b> (all)
	<b>console_application</b> (yes)
	<b>precompiled</b> (&quot;$EIFFEL5\precomp\spec\$PLATFORM\base&quot;)

<b>cluster</b>
	root_cluster: &quot;$EIFFEL5\examples\store\insert&quot;;
	estore_examples_objects:&quot;$EIFFEL5\examples\store\Utilities&quot;;
	oracle_handle: &quot;$EIFFEL5\examples\store\Utilities\oracle&quot;;

		<font color="#FF0000">-- EiffelBase</font>
	<b>all</b> base: &quot;$EIFFEL5/library/base&quot;
		<b>exclude</b>
			&quot;desc&quot;;&quot;table_eiffel3&quot;
		<b>end

</b>		<font color="#FF0000">-- EiffelStore
</font>	estore_support: &quot;$EIFFEL5\library\store\support&quot;;
	estore_interface: &quot;$EIFFEL5\library\store\interface&quot;;
	estore_db_support: &quot;$EIFFEL5\library\store\dbms\support&quot;;
	estore_oracle: &quot;$EIFFEL5\library\store\dbms\rdbms\oracle&quot;;

<font color="#FF0000">		-- EiffelTime
</font>	time: &quot;$EIFFEL5\library\time&quot;;
	time_format(time): &quot;$\format&quot;;
	english_format(time_format): &quot;$\english&quot;;

<b>external</b>

	<b>include_path</b>:&nbsp;&nbsp; 	&quot;$(EIFFEL5)\library\store\dbms\rdbms\oracle\Clib&quot;,
			&quot;$(ORACLE_HOME)\OCI\include&quot;
	<b>object</b>:
			&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\support.lib&quot;,
			&quot;$(EIFFEL5)\library\time\spec\$(COMPILER)\lib\datetime.lib&quot;,
			&quot;$(EIFFEL5)\library\store\spec\$(COMPILER)\lib\oracle_store.lib&quot;,
			&quot;$(ORACLE_HOME)\OCI\lib\msvc\oci.lib&quot;
<b>end</b></pre>
</td>
  </tr>
</table>
</center>
<h1><a name="connectData">How connect your Database</a></h1>
<p>To see all the step of connecting to your Database, let's see the init
feature of the <a href="#Insert"> Insert example</a>:<br>
We use in that case the Oracle example as the connection only ask for a login
name and a password.</p>
<center>
<table border="0">
  <tr>
    <td bgcolor="#FFFFE6">
    <pre>init is
<font color="#FF0000">		-- Init session.</font><i>
	local
		tmp_string: STRING
	do
</i><font color="#FF0000">			-- Ask for user's name and password</font><i>
		io.putstring (&quot;Database user authentication:%N&quot;)
		io.putstring (&quot;Name: &quot;)
		io.readline
		tmp_string := clone (io.laststring)
		io.putstring (&quot;Password: &quot;)
		io.readline

</i><font color="#FF0000">			-- Set user's name and password</font><i>
		login (tmp_string, io.laststring)

</i><font color="#FF0000">			-- Initialization of the Relational Database:
			-- This will set various information to perform a correct
			-- connection to the Relational database</font><i>
		set_base
</i>
<font color="#FF0000">			-- Create usefull classes
			-- 'session_control' provides information control access and&nbsp;
			--  the status of the database.
			-- 'base_store' provides updating facilities.</font><i>
		create session_control.make
		create base_store.make

</i><font color="#FF0000">			-- Start session</font><i>
		session_control.connect

	ensure
		not (session_control = Void)
		not (base_store = Void)
	end</pre>

    </i>

</td>
  </tr>
</table>
</center>

<p>Now you are connected to your database, and you can perform a query.</p>
<h1><a name="query">How to realize a basic query</a></h1>
<p>To see all the step of a basic query, let's see the make_selection feature of
the <a href="#Select"> Select example</a>.</p>
<center>
<table border="0">
  <tr>
    <td bgcolor="#FFFFE6">
<pre>make_selection is
<font color="#FF0000">		-- Select books whose author's name match
		-- a specific name.
		-- The name must be written in upper-case letters, and
		-- enclosed in '%' (This caracter is used by SQL to match&nbsp;
		-- any string of zero or more character)</font><i>

	local
		author: STRING
	do
		from
			io.putstring (&quot;Author? ('exit' to terminate):&quot;)
			io.readline
		until
	</i>		-<font color="#FF0000">- Terminate?</font><i>
		io.laststring.is_equal (&quot;exit&quot;)

		loop
			author := clone (io.laststring)
			io.putstring (&quot;Seeking for books whose author's name match: &quot;)
			io.putstring (author)
			io.new_line
			io.new_line
</i><font color="#FF0000">				-- A mapped Eiffel object (author) is referred to by a key name
				-- &quot;author_name&quot; which can be used in a SQL statement prepended with ':'</font><i>
			base_selection.set_map_name (author, &quot;author_name&quot;)

</i><font color="#FF0000">				-- Set action to be executed after each 'load_result' iteration step.
				-- 'init' and 'execute' method of the current class are to be used.</font><i>
			base_selection.set_action (Current)

</i><font color="#FF0000">				-- Query database.
				-- The reference &quot;:author_name&quot; will be changed to the value of
				-- the Eiffel object referred to by the key &quot;author_name&quot;.</font><i>
			base_selection.query (&quot;select * from DB_BOOK where author = :author_name&quot;)

</i><font color="#FF0000">				-- Iterate through resulting data, and display them</font><i>
			base_selection.load_result

</i><font color="#FF0000">				-- Delete &quot;author_name&quot; from the map table</font><i>
			base_selection.unset_map_name (&quot;author_name&quot;)

</i>				<font color="#FF0000">-- Terminate the current order</font><i>
			base_selection.terminate

			io.new_line
			io.putstring (&quot;Author? ('exit' to terminate):&quot;)
			io.readline
		end
	end</pre>
</i>
</td>
</tr>
</table>
</center>
<p>Thus, to perform a query you need to create a DB_SELECTION object (base_selection
in this example). Then you can follow all the steps of this example.</p>
<h1><a name="Examples">Some Working Examples</a></h1>
<p>We developed 7 Examples that you can try to understand EiffelStore.</p>
<p>They are in the directory : &quot;$EIFFEL5\examples\store&quot;</p>
<p>We recommend you to try the examples in the following order:</p>
<ul>
  <li><a href="#Esql">Esql</a><br>
    &nbsp;&nbsp;&nbsp; Very useful to test you Database connection.</li>
  <li><a href="#Select">Select</a><br>
    &nbsp;&nbsp;&nbsp; The basic example for a query of your Database.</li>
  <li><a href="#Insert">Insert</a><br>
    &nbsp;&nbsp;&nbsp; The basic example for an insert in you Database</li>
  <li><a href="#Nesting">Nesting</a><br>
    &nbsp;&nbsp;&nbsp; An Example of Nested queries.</li>
  <li><a href="#Rm2oom">rm2oom</a><br>
    &nbsp;&nbsp;&nbsp; From an Relationnal Model to an Object Oriented Model.</li>
  <li><a href="#Oo2rm">oo2rm</a><br>
    &nbsp;&nbsp;&nbsp; From an Object Oriente Model to an Relationnal Model.</li>
  <li><a href="#Convert">convert</a><br>
    &nbsp;&nbsp;&nbsp; to exercise the flat file conversion utilities.</li>
</ul>
<h2><a name="Esql">Esql</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>To run esql, you just need to launch : esql.</p>
<p>Then this example illustrates how to access database information.</p>
<p>SQL statements are filtered through a monitor and sent to the RDBMS.</p>
<p>Remarks : Once you made an SQL Statements, you should not ended it using a
semi-colon. Indeed, you can do it with Oracle statement but not with ODBC
statements.</p>
<h2><a name="Select">Select</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>To run this example. launch: book_select</p>
<p>This example illustrates how to perform a select query.</p>
<p>It is very interesting because you can understand the query method of
EiffelStore.</p>
<p>Before running this example you have to copy the right file in the W_code
directory of your project.</p>
<p>Thus for an Oracle Database, you have to copy data.sql.oracle in W_code and
rename it as data.sql.</p>
<p>For an ODBC Database, you have to copy data.sql.odbc in W_code and rename it
as data.sql.</p>
<p>For a Sybase Database, you have to copy data.sql.sybase in W_code and rename
it as data.sql.</p>
<p>For an Ingres Database, you have to copy data.sql.ingres in W_code and rename
it as data.sql.</p>
<h2><a name="Insert">Insert</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>To run this example launch book_insert.</p>
<p>This example illustrates how Eiffel users may access their selected Database to insert or modify objects in existing tables.<br>
<br>
An Eiffel object, say &quot;`a book'', described by class BOOK, is inserted into a repository (instance of class REPOSITORY) defined
with `db_book' access key for instance.</p>
<p>The repository name should match an external RDB table named `db_book'.</p>
<p>In the example, the session terminates on unexisting RDB table.<br>
<br>
Class DB_CHANGE encapsulates features supporting insertion statements.<br>
<br>
SQL insert statements insert new objects into existing repositories (i.e existing RDM tables).<br>
<br>
Class DB_CONTROL provides facilities to manage the session, control the DB status, and query the results.</p>
<h2><a name="Nesting">Nesting</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>This example illustrates how to customize actions when retrieved selection
Results.</p>
<p>In that way it does two nested queries to retrieve all the tables and all the
columns of your Database.&nbsp;</p>
<h2><a name="Rm2oom">Rm2oom</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>This example illustrates how RDBS tables can be translated into Eiffel class definitions where
features are simply attributes matching the DB table fields.<br>
<br>
Class descriptions are printed on standard output.<br>
<br>
A specific repository is referred to by a name that should match a RDB table name for which an Eiffel
class equivalent is requested.</p>
<h2><a name="Oo2rm">Oo2rm</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>Object Oriented Model To Relational Model (OOM2RM)<br>
<br>
This example illustrates how to dynamically generate the description of a relational schema (with SQL
statements)&nbsp; from the traversal of a network of Eiffel objects.<br>
<br>
One Eiffel model sample is given in subdirectory <b> Model1</b> and serves as the sample to use to generate
the relational schema.<br>
<br>
To apply the example on a model of your choice, replace in the Ace file reference to the cluster
<b> Model1</b> with a reference to your customized cluster.<br>
<br>
<br>
Remarks:<br>
Some problems have been encountered when using generic containers classes derived with simple type.
To overcome this problem, rather use ARRAY [INTEGER_REF] instead of ARRAY [INTEGER].</p>
<h2><a name="Convert">Convert</a></h2>
<p>Make sure that you have read the <a href="#TOP">previous explanations</a>
before running this example.</p>
<p>This example illustrates the way one can convert Unix flat files into class instances.<br>
<br>
Changing a field (it's type or format) in an example.dat file, highlighs the parser error
detection mechanism.<br>
<br>
When the example has been compiled, put the two files "example1.dat" and "example2.dat" in the
directory "EIFGEN/W_CODE" or in &quot;EIFGEN/F_code&quot; directory depending on your type of Eiffel
compilation.</p>
<!--msnavigation--></td></tr><!--msnavigation--></table></body>

</html>
