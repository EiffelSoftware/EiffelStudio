<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Xebra Tutorial </title>
<style type="text/css">
<!--
body,td,th {
	font-family: Geneva, Arial, Helvetica, sans-serif;
	font-size: 16px;
	color: #333333;
}
h1 {
	color: #000099;
}
h2 {
	color: #003399;
}
h3 {
	color: #0033FF;
}
.code {
	font-family: "Courier New", Courier, monospace;
	font-size: 17px;
	font-style: normal;
	font-weight: bold;
	color: #000000;
}
-->
</style>
</head>

<body>
<h1>Xebra Tutorial </h1>
<h2>Notes</h2>
<p><strong>Use Xebra revision 78296 for this tutorial</strong>.</p>
<p>Eiffel source is expected to be in <span class="code">$EIFFEL_SRC,</span> and the c libraries are expected to be compiled</p>
<p>The tutorial is written for Ubuntu 8.10</p>
<h2>Checkout</h2>
<ul>
  <li>Checkout xebra from <a href="https://svn.origo.ethz.ch/eiffelstudio/trunk/Src/framework/web/xebra/" class="code">https://svn.origo.ethz.ch/eiffelstudio/trunk/Src/framework/web/xebra/</a> to <span class="code">$XEBRA_DEV</span></li>
</ul>
<p>&nbsp;</p>
<h2>Setup mod_xebra </h2>
<p><strong>Note</strong>: Mod_xebra does currently not run with the apache distribution that comes with ubuntu. </p>
<p><strong>Note</strong>: If you are running Ubuntu 8.10 on amd64 you can try to use the compiled version of apache  at <span class="code">$XEBRA_DEV/c_projects/mod_xebra/apache2-2-11_modXebra.tar.gz</span>. Just extract it and run <span class="code">sudo bin/apachectl start</span> </p>
<ul>
  <li>  Download apache unix source httpd-2.2.11 from <span class="code"><a href="http://httpd.apache.org/download.cgi">http://httpd.apache.org/download.cgi</a></span><a href="http://httpd.apache.org/download.cgi"><br />
    <br />
  </a></li>
  <li> Extract <br />
    <br />
  </li>
  <li> Compile and install apache<br />
    lets say <span class="code">$APACHE2 </span>points to <span class="code">/home/fabioz/apache2</span><br />
    (see here for installation: <a href="http://httpd.apache.org/docs/2.2/install.html">Install</a> ). Run the following command:<br />
    <span class="code">CFLAGS=&quot;-ggdb&quot; ./configure --prefix=/home/fabioz/apache2</span><br />
    with CFLAGs you can add compiler flags like -ggdb (which generates debug information for gdb)<br />
    then run<br />
    <span class="code"><strong>make</strong><br />
  <strong>make install</strong></span><br />
  <br />
  </li>
  <li> Compile the module by running<br />
    <span class="code"><strong>cd $XEBRA_DEV/c_projects/mod_xebra</strong><br />
    <strong>$APACHE2/bin/apxs -c -Wc,-ggdb -I$EIFFEL_SRC/C/run-time -I$EIFFEL_SRC/C/run-time/include mod_xebra.c mod_xebra.h</strong></span><br />
    <br />
  </li>
  <li> Install the module to apache by running<br />
    <span class="code">sudo <strong>$APACHE2/bin/</strong>apxs -i mod_xebra.la</span><br />
    <br />
  </li>
  <li> Add the following lines to <span class="code"><strong>$APACHE2</strong>/conf/httpd.conf</span>:<br />
    <span class="code">LoadModule xebra_module modules/mod_xebra.so</span><br />
    <span class="code">AddHandler mod_xebra .xeb<br />
    XebraServer_port &quot;55000&quot;<br />
  XebraServer_host &quot;localhost&quot;</span><br />
  <span class="code">LogLevel debug</span><br />
  <br />
  </li>
  <li> Restart apache (if necessary, you need to stop and start instead of restart)<br />
  <span class="code">sudo <strong>$APACHE2/bin/</strong>apachectl restart</span><br />
  <br />
  </li>
  <li>Browse to <span class="code">http://localhost/test.xeb</span>.You should see the Fail Whale and a message saying &quot;Cannot connect to XebraServer. See apache error log.&quot;<br />
    <br />
  </li>
  <li> Hint: keep an eye on the apache error log<br />
    <span class="code">tail -f <strong>$APACHE2</strong>/logs/error_log</span></li>
</ul>
<p>&nbsp;</p>
<h2>Run the Xebra Server</h2>
<ul>
  <li>Open the eiffel project <span class="code">$XEBRA_DEV/eiffel_projects/xebra_server/xebra_server.ecf</span><br />
    <br />
  </li>
  <li>Compile and Run<br />
    <br />
  </li>
  <li>Browse again to <span class="code">http://localhost/test.xeb</span>.You should see a Xebra Server Error Report (also with the Fail Whale) with a message saying &quot;Cannot find web application ' ' &quot;<br />
</li>
</ul>
<p>&nbsp;</p>
<h2>Run the Xebrawebapp (simple web application)</h2>
<p>You can use the tutorial web application <span class="code">xebrawebapp</span> at <span class="code">$XEBRA_DEV/websites/xebrawebapp</span> to start. To use it do the following:</p>
<ul>
  <li>Create the Folder <span class="code">$APACHE2/htdocs/xebrawebapp<br />
  </span></li>
</ul>
<ul><li>Run<br />
    <span class="code">cd $XEBRA_DEV/websites/xebrawebapp/<br />
    ./generate-webapp.sh</span><br />
    (due to a current bug, you have to run the script twice)<br />
    <br />
    </li>
  <li>Open the project at <span class="code">$XEBRA_DEV/websites/xebrawebapp/</span> in eiffelstudio and compile<br />
      <br />
  </li>
  <li>Make sure the xebra server and the correct apache (with xebra_mod) is running, then run the web application<br />
      <br />
  </li>
  <li>Browse to <span class="code">http://localhost/xebrawebapp/hello.xeb</span>, you should see &quot;Hello World!&quot;</li>
</ul>
<p>&nbsp;</p>
<h2>Run the Demoapplication (advanced web application)</h2>
<ul><li>
  <p>You can use the tutorial web application <span class="code">demoapplication</span> at <span class="code">$XEBRA_DEV/websites/demoapplication</span> to start. To use it do the following:  
      <br />
    </p>
    <ul><li>Create the Folder <span class="code">$APACHE2/htdocs/demoapplication<br />
        <br />
      </span></li>
      <li>Copy the folder <span class="code">$XEBRA_DEV/</span><span class="code">websites/demoapplication/html/images</span> to<span class="code"> $APACHE2/htdocs/demoapplication</span><br />
        <br />
      </li>
      <li>Copy <span class="code">$XEBRA_DEV/websites/demoapplication/html/style.css</span> to <span class="code">$APACHE2/htdocs/demoapplication</span><span class="code">/<br />
        <br />
      </span></li>
    </ul>
    <ul>
      <li>Run<br />
        <span class="code">cd $XEBRA_DEV/websites/demoapplication/<br />
          ./generate-webapp.sh</span><br />
          (due to a current bug, you have to run the script twice)<br />
        <br />
      </li>
      <li>Open the project at <span class="code">$XEBRA_DEV/websites/demoapplication/</span> in eiffelstudio and compile<br />
        <br />
      </li>
      <li>Make sure the xebra server and the correct apache (with xebra_mod) is running, then run the web application<br />
        <br />
      </li>
      <li>Browse to <span class="code">http://localhost/demoapplication/home.xeb</span>, you should see the site</li>
    </ul>
    <br />
  </li>
</ul>
<h2>Create a new Web Application</h2>
<p>If you want to create your own application remember the following important steps:
  <span class="code"><br />
</span></p>
<ul>
  <li>Add the libraries
    <ul>
      <li><span class="code">base-safe.ecf</span><span class="code">,</span></li>
      <li><span class="code">$XEBRA_DEV/eiffel_projects/library/xebra_http/xebra_http.ecf</span></li>
      <li><span class="code">$XEBRA_DEV/eiffel_projects/library/xebra_web_application/xebra_web_application.ecf</span></li>
      <li>don't use precompile<br />
        <br />
        </li>
    </ul>
  </li>
  <li>Create the folder: <span class="code">$WEBAPP/servlet_gen</span><br />
    <br />
  </li>
  <li>Create the xeb files in  <span class="code">$WEBAPP</span><br />
    <br />
  </li>
  <li>Create a new class <span class="code">(YOURNAME)_CONTROLLER</span> that inherits from <span class="code">XWA_CONTROLLER</span><br />
    <br />
    </li>
  <li>Create a new class <span class="code">(YOURNAME)_GLOBAL_STATE</span><br />
    <br />
  </li>
  <li>Change the root class to <span class="code">(YOURNAME)_G_APPLICATION<br />
    </span><br />
  </li>
  <li>Set project settings - target - advanced - multithreaded to true<span class="code"><br />
    <br />
  </span></li>
  <li>Adapt the three files <span class="code">generate-webapp.sh,</span> <span class="code">input_servlet_gen.txt</span> and <span class="code">input_translator.txt</span> to match the new paths<br />  
    <br />
  </li>
  <li>Create the folder <span class="code">$APACHE2/htdocs/(YOURNAME)</span></li>
</ul>
</body>
</html>
